// src/app/pipeline/pipeline.component.scss

.pipeline-canvas-container {
  width: 100%;
  height: 100%;
  position: relative;
  overflow: hidden;
}

.canvas-area {
  width: 100%;
  height: 100%;
  position: relative;
  background-color: #f9f9f9;
  background-image: radial-gradient(#ddd 1px, transparent 1px);
  background-size: 20px 20px;
  overflow: auto; // 允许内容溢出时滚动
}

.pipeline-svg {
  width: 100%;
  height: 100%;
  user-select: none;
}

/* 节点样式 */
.node {
  cursor: move;
  transition: transform 0.1s ease-out;
  
  &.selected {
    .node-body {
      stroke: #2196F3;
      stroke-width: 3px;
    }
  }
  
  &.edge-source {
    .node-body {
      stroke: #FF9800;
      stroke-width: 3px;
    }
    cursor: default; // 改变光标，表示正在连线
  }
  
  .node-highlight {
    fill: rgba(33, 150, 243, 0.3);
    opacity: 0;
    transition: opacity 0.2s;
    
    &.visible {
      opacity: 1;
    }
  }
  
  .node-body {
    fill: #fff;
    stroke: #333;
    stroke-width: 2px;
    transition: stroke 0.2s, fill 0.2s;
  }
  
  .node-type {
    font-size: 10px;
    text-anchor: middle;
    fill: #666;
    // 添加文本溢出处理
    text-overflow: ellipsis;
  }
  
  .node-name {
    font-size: 12px;
    text-anchor: middle;
    fill: #333;
    font-weight: bold;
    // 确保文本不会溢出
    text-overflow: ellipsis;
  }
  
  &:hover .node-body {
    fill: #f5f5f5;
  }
  
  &.source-node .node-body {
    stroke: #4CAF50;
    stroke-width: 3px;
  }
  
  &.sink-node .node-body {
    stroke: #FF5722;
    stroke-width: 3px;
  }
  
  .source-marker {
    fill: #4CAF50;
    stroke: white;
    stroke-width: 1px;
  }
  
  .sink-marker {
    fill: #FF5722;
    stroke: white;
    stroke-width: 1px;
  }
}

/* 边缘样式 */
.edge {
  pointer-events: auto; // 允许边缘交互
  
  path {
    transition: stroke 0.2s;
    cursor: pointer; // 显示可点击
    
    &:hover {
      stroke: #FF5722; // 悬停时高亮显示
      stroke-width: 3px;
    }
  }
  
  .edge-label {
    font-size: 10px;
    fill: #666;
    pointer-events: none;
  }
}

/* 控制面板样式 - 修改为更紧凑的布局 */
.control-panel {
  position: fixed;
  bottom: 20px;
  right: 20px;
  display: flex;
  flex-direction: column; /* 改为纵向排列 */
  align-items: flex-end; /* 右对齐 */
  gap: 10px;
  z-index: 100;
  max-width: 300px; /* 限制最大宽度 */
  background-color: rgba(255, 255, 255, 0.9); /* 半透明背景 */
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

/* 美化保存按钮 - 调整大小和对齐 */
.save-btn {
  background-color: #1890ff;
  color: white;
  border: none;
  padding: 6px 12px; /* 减小内边距 */
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.3s;
  font-size: 14px; /* 调整字体大小 */
  align-self: flex-end; /* 确保右对齐 */
  width: auto; /* 根据内容自适应宽度 */
}

.save-btn:hover {
  background-color: #40a9ff;
}

.save-btn:active {
  background-color: #096dd9;
}

/* 美化Pipeline信息输入区域 */
.pipeline-info-inputs {
  margin-bottom: 12px;
  background-color: #f5f5f5;
  padding: 12px;
  border-radius: 6px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  width: 100%; /* 确保宽度一致 */
}

.input-group {
  margin-bottom: 8px; /* 减小间距 */
}

.input-group label {
  display: block;
  margin-bottom: 4px;
  font-weight: 500;
  color: #333;
  font-size: 13px; /* 调整标签字体大小 */
}

.pipeline-name-input,
.pipeline-desc-input {
  width: 100%;
  padding: 6px 10px; /* 减小内边距 */
  border: 1px solid #d9d9d9;
  border-radius: 4px;
  font-size: 13px; /* 调整输入框字体大小 */
  transition: all 0.3s;
}

.pipeline-desc-input {
  min-height: 50px; /* 减小文本区域高度 */
  resize: vertical;
}

/* 取消连线按钮样式 */
.cancel-btn {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 6px 12px; /* 与保存按钮保持一致 */
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.3s;
  font-size: 14px;
  align-self: flex-end; /* 确保右对齐 */
}

.cancel-btn:hover {
  background-color: #d32f2f;
}

/* 拖动相关样式 */
.cdk-drag-preview {
  opacity: 0.8;
}

.cdk-drag-animating {
  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);
}

  
  .canvas-area {
    position: absolute; /* Allows SVG to fill the container */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    // Add a background grid pattern if desired
    // background-image: linear-gradient(to right, #eee 1px, transparent 1px), linear-gradient(to bottom, #eee 1px, transparent 1px);
    // background-size: 20px 20px;
  }
  
  svg {
    display: block; /* Remove extra space below SVG */
  }
  
  // Style for edges
  svg .edges line {
    cursor: pointer;
    &:hover {
      stroke: #007bff; // Highlight on hover
    }
  }
  
  // Style for nodes group
  svg .nodes {
    // You can add common styles for node groups here
  }
  
  // Style for individual nodes (the <g> elements)
  svg .nodes > g {
    cursor: grab; // Indicate draggable
    transition: transform 0.1s ease-out; // Smooth movement while dragging
    // Optional: Add a class for selected state
    &.selected circle {
        stroke: royalblue !important;
        stroke-width: 3 !important;
    }
  }
  
  // Style for the ghost element while dragging a node on the canvas
  svg .cdk-drag-preview {
    box-sizing: border-box;
    border-radius: 50%; /* Match node shape if circular */
    box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2),
                0 8px 10px 1px rgba(0, 0, 0, 0.14),
                0 3px 14px 2px rgba(0, 0, 0, 0.12);
    opacity: 0.8;
    // You might need to adjust padding/margin depending on how the preview is generated
  }
  
  // Style for the placeholder element where the item was dragged from (on canvas)
  svg .cdk-drag-placeholder {
     opacity: 0; // Hide the original node's placeholder
  }
  
  // Style for the element being dragged on canvas
  svg .cdk-drag-dragging {
    // The actual element being dragged might be hidden by cdk-drag-preview, or styled here
    // opacity: 0.5;
  }
  
  
  .control-panel {
    padding: 10px;
    background-color: #eee;
    text-align: center;
    button {
      margin: 0 5px;
      padding: 8px 15px;
      cursor: pointer;
    }
  }
  
  /* Optional: Styles for node ports */
  // .port {
  //   cursor: crosshair;
  //   &:hover {
  //     fill: yellow !important;
  //   }
  // }

/* 添加连线提示 */
.edge-creation-hint {
  position: fixed;
  bottom: 70px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 14px;
  z-index: 1000;
  pointer-events: none;
}

/* 添加错误提示样式 */
.edge-error-hint {
  position: fixed;
  bottom: 120px;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(244, 67, 54, 0.9);
  color: white;
  padding: 8px 16px;
  border-radius: 4px;
  font-size: 14px;
  z-index: 1000;
  pointer-events: none;
  animation: fadeOut 3s forwards;
}

@keyframes fadeOut {
  0% { opacity: 1; }
  70% { opacity: 1; }
  100% { opacity: 0; }
}

/* 节点右键菜单样式 */
.node-context-menu {
  position: fixed;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  z-index: 1000;
  min-width: 150px;
  
  .menu-item {
    padding: 8px 16px;
    cursor: pointer;
    transition: background-color 0.2s;
    
    &:hover {
      background-color: #f5f5f5;
    }
    
    &:not(:last-child) {
      border-bottom: 1px solid #eee;
    }
    
    &.delete-item {
      color: #f44336; /* 删除选项使用红色 */
    }
  }
}

/* 边的右键菜单样式 */
.edge-context-menu {
  position: fixed;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.2);
  z-index: 1000;
  min-width: 150px;
  
  .menu-item {
    padding: 8px 16px;
    cursor: pointer;
    transition: background-color 0.2s;
    
    &:hover {
      background-color: #f5f5f5;
    }
    
    &.delete-item {
      color: #f44336; /* 删除选项使用红色 */
    }
  }
}

/* 使边可点击 */
.edge path {
  cursor: pointer;
  
  &:hover {
    stroke: #007bff;
    stroke-width: 3px;
  }
}

/* 自定义悬浮提示样式 */
.node {
  position: relative;
  
  &:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    top: -40px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 5px 10px;
    border-radius: 4px;
    font-size: 12px;
    white-space: pre-wrap;
    max-width: 200px;
    z-index: 1000;
    pointer-events: none;
  }
}

.node {
  cursor: move;
  
  .node-highlight {
    fill: transparent;
    stroke: #4285f4;
    stroke-width: 2px;
    opacity: 0;
    transition: opacity 0.2s;
    
    &.visible {
      opacity: 1;
    }
  }
  
  .node-body {
    fill: #f5f5f5;
    stroke: #ddd;
    stroke-width: 1px;
  }
  
  .node-type {
    font-size: 12px; // 增大字体大小
    text-anchor: middle;
    fill: #666;
  }
  
  .node-name {
    font-size: 14px; // 增大字体大小
    text-anchor: middle;
    fill: #333;
    font-weight: bold;
  }
  
  &:hover .node-body {
    fill: #f5f5f5;
  }
  
  &.source-node .node-body {
    stroke: #4CAF50;
    stroke-width: 3px;
  }
  
  &.sink-node .node-body {
    stroke: #FF5722;
    stroke-width: 3px;
  }
  
  .source-marker {
    fill: #4CAF50;
    stroke: white;
    stroke-width: 1px;
  }
  
  .sink-marker {
    fill: #FF5722;
    stroke: white;
    stroke-width: 1px;
  }
}

/* 边的样式 */
.edge {
  path {
    stroke: #555;
    stroke-width: 2;
    fill: none;
    cursor: pointer;
    transition: stroke 0.2s, stroke-width 0.2s;
    
    &:hover {
      stroke: #007bff;
      stroke-width: 3;
    }
  }
  
  .edge-label {
    font-size: 12px;
    fill: #666;
    pointer-events: none; /* 确保文本不会阻止点击边 */
  }
}

/* 箭头样式 */
#arrowhead {
  path {
    fill: #555;
  }
}
.node {
  transition: transform 0.1s ease-out;
}
# SAGE å®‰è£…é€Ÿåº¦ä¼˜åŒ–æŒ‡å—

## å½“å‰ç“¶é¢ˆåˆ†æž

ä»Žä½ çš„å®‰è£…æ—¥å¿—çœ‹ï¼Œå¤–éƒ¨ä¾èµ–å®‰è£…å·²è¿è¡Œ **33 åˆ†é’Ÿ**ï¼ˆ1984 ç§’ï¼‰ï¼Œè¿™æ˜¯æ­£å¸¸ä½†å¯ä»¥ä¼˜åŒ–çš„ï¼š

### 1. ä¾èµ–æ•°é‡å¤šï¼ˆ110 ä¸ªåŒ…ï¼‰

- åŒ…æ‹¬å¤§åž‹æ·±åº¦å­¦ä¹ æ¡†æž¶ï¼štorch, torchvision, transformers
- æ¯ä¸ªåŒ…éƒ½æœ‰è‡ªå·±çš„ä¼ é€’ä¾èµ–
- pip éœ€è¦è§£æžæ•´ä¸ªä¾èµ–æ ‘

### 2. ç½‘ç»œä¸‹è½½æ…¢

- å¤§åž‹åŒ…ï¼ˆtorch ~2GB, torchvision ~500MB, opencv ~80MBï¼‰
- ä»Ž PyPI å®˜æ–¹æºä¸‹è½½ï¼ˆå›½å¤–æœåŠ¡å™¨ï¼‰
- æ—¥å¿—æ˜¾ç¤ºå¹³å‡ä¸‹è½½é€Ÿåº¦éœ€ç›‘æŽ§

### 3. ç¼–è¯‘æ—¶é—´é•¿

- CUDA ç›¸å…³åŒ…éœ€è¦ç¼–è¯‘ï¼ˆnvidia-cuda-nvrtc-cu12, nvidia-cudnn-cu12ï¼‰
- æŸäº› C++ æ‰©å±•åŒ…ï¼ˆå¦‚ opencv-python-headlessï¼‰

## ç«‹å³å¯ç”¨çš„ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨å›½å†…é•œåƒæºï¼ˆæœ€æœ‰æ•ˆï¼‰

**æ¸…åŽ PyPI é•œåƒ**ï¼š

```bash
# æ–¹æ³• Aï¼šçŽ¯å¢ƒå˜é‡ï¼ˆæŽ¨èï¼‰
export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
export PIP_TRUSTED_HOST=pypi.tuna.tsinghua.edu.cn
./quickstart.sh --dev --yes

# æ–¹æ³• Bï¼špip é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰
mkdir -p ~/.pip
cat > ~/.pip/pip.conf <<EOF
[global]
index-url = https://pypi.tuna.tsinghua.edu.cn/simple
trusted-host = pypi.tuna.tsinghua.edu.cn
EOF
./quickstart.sh --dev --yes
```

**é˜¿é‡Œäº‘ PyPI é•œåƒ**ï¼ˆå¤‡é€‰ï¼‰ï¼š

```bash
export PIP_INDEX_URL=https://mirrors.aliyun.com/pypi/simple/
export PIP_TRUSTED_HOST=mirrors.aliyun.com
```

**æ•ˆæžœ**ï¼šä¸‹è½½é€Ÿåº¦å¯æå‡ **5-10 å€**ï¼ˆä»Ž 0.3 MB/s æå‡åˆ° 3-10 MB/sï¼‰

### æ–¹æ¡ˆ 2ï¼šè·³è¿‡å·²å®‰è£…çš„åŒ…ï¼ˆæ–­ç‚¹ç»­ä¼ ï¼‰

å¦‚æžœå®‰è£…è¿‡ç¨‹è¢«ä¸­æ–­ï¼Œä½¿ç”¨ `--resume`ï¼š

```bash
./quickstart.sh --dev --yes --resume
```

è¿™ä¼šè·³è¿‡å·²å®‰è£…çš„å¤–éƒ¨ä¾èµ–ï¼Œç›´æŽ¥è¿›å…¥ä¸‹ä¸€æ­¥ã€‚

### æ–¹æ¡ˆ 3ï¼šä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶åŒ…ï¼ˆé¿å…ç¼–è¯‘ï¼‰

æŸäº›åŒ…æœ‰é¢„ç¼–è¯‘çš„ wheel æ–‡ä»¶ï¼Œä½† pip å¯èƒ½é»˜è®¤é€‰æ‹©æºç åŒ…ã€‚å¼ºåˆ¶ä½¿ç”¨äºŒè¿›åˆ¶åŒ…ï¼š

```bash
export PIP_PREFER_BINARY=1
./quickstart.sh --dev --yes
```

### æ–¹æ¡ˆ 4ï¼šå¹¶è¡Œä¸‹è½½ï¼ˆpip 20.3+ï¼‰

```bash
export PIP_CONCURRENT_DOWNLOADS=8  # å¹¶è¡Œä¸‹è½½ 8 ä¸ªåŒ…
./quickstart.sh --dev --yes
```

### æ–¹æ¡ˆ 5ï¼šç¦ç”¨ pip ç¼“å­˜ï¼ˆèŠ‚çœç£ç›˜ I/Oï¼‰

å¦‚æžœç£ç›˜ I/O æ˜¯ç“¶é¢ˆï¼š

```bash
export PIP_NO_CACHE_DIR=1
./quickstart.sh --dev --yes
```

## ç»„åˆä¼˜åŒ–ï¼ˆæœ€å¿«æ–¹æ¡ˆï¼‰

**æŽ¨èé…ç½®**ï¼ˆé€‚åˆå›½å†…ç”¨æˆ·ï¼‰ï¼š

```bash
# 1. è®¾ç½®é•œåƒæº
export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
export PIP_TRUSTED_HOST=pypi.tuna.tsinghua.edu.cn

# 2. å¹¶è¡Œä¸‹è½½
export PIP_CONCURRENT_DOWNLOADS=8

# 3. ä¼˜å…ˆäºŒè¿›åˆ¶åŒ…
export PIP_PREFER_BINARY=1

# 4. è¿è¡Œå®‰è£…
./quickstart.sh --dev --yes
```

**é¢„æœŸæ•ˆæžœ**ï¼š

- **åŽŸå§‹æ—¶é—´**ï¼š30-40 åˆ†é’Ÿ
- **ä¼˜åŒ–åŽæ—¶é—´**ï¼š10-15 åˆ†é’Ÿï¼ˆæé€Ÿ 60-70%ï¼‰

## é«˜çº§ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šåˆ†é˜¶æ®µå®‰è£…ï¼ˆå‡å°‘ä¾èµ–è§£æžæ—¶é—´ï¼‰

ä¸ä¸€æ¬¡æ€§å®‰è£… 110 ä¸ªåŒ…ï¼Œè€Œæ˜¯åˆ†æ‰¹å®‰è£…ï¼š

1. **å…ˆå®‰è£…æ ¸å¿ƒä¾èµ–**ï¼ˆ30 ä¸ªåŒ…ï¼Œ5 åˆ†é’Ÿï¼‰
1. **å†å®‰è£… ML æ¡†æž¶**ï¼ˆtorch, transformers ç­‰ï¼Œ15 åˆ†é’Ÿï¼‰
1. **æœ€åŽå®‰è£…å¯é€‰ä¾èµ–**ï¼ˆå‰©ä½™åŒ…ï¼Œ5 åˆ†é’Ÿï¼‰

**å®žçŽ°æ–¹å¼**ï¼šä¿®æ”¹ `quickstart.sh` æ·»åŠ  `--fast` æ¨¡å¼ã€‚

### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Conda ä»£æ›¿ pipï¼ˆæŽ¨èç”¨äºŽ ML é¡¹ç›®ï¼‰

Conda ä½¿ç”¨äºŒè¿›åˆ¶åŒ…ï¼Œé¿å…ç¼–è¯‘ï¼š

```bash
# 1. åˆ›å»º conda çŽ¯å¢ƒ
conda create -n sage python=3.11 -y
conda activate sage

# 2. ä½¿ç”¨ conda å®‰è£…å¤§åž‹åŒ…
conda install -c pytorch -c nvidia pytorch torchvision pytorch-cuda=12.4 -y
conda install -c conda-forge transformers datasets faiss-cpu -y

# 3. å†è¿è¡Œ quickstart.shï¼ˆè·³è¿‡å·²å®‰è£…çš„åŒ…ï¼‰
./quickstart.sh --dev --yes --conda
```

**æ•ˆæžœ**ï¼šé¿å… torch/torchvision çš„ç¼–è¯‘ï¼ŒèŠ‚çœ **10-15 åˆ†é’Ÿ**ã€‚

### æ–¹æ¡ˆ Cï¼šä½¿ç”¨ Docker é¢„æž„å»ºé•œåƒ

æˆ‘ä»¬å¯ä»¥æä¾›é¢„æž„å»ºçš„ Docker é•œåƒï¼ˆåŒ…å«æ‰€æœ‰ä¾èµ–ï¼‰ï¼š

```bash
docker pull intellistream/sage:dev-latest
docker run -it --gpus all -v $(pwd):/workspace intellistream/sage:dev-latest
```

**æ•ˆæžœ**ï¼šä»Ž 40 åˆ†é’Ÿ â†’ **5 åˆ†é’Ÿ**ï¼ˆä»…ä¸‹è½½é•œåƒï¼‰ã€‚

## ç›‘æŽ§å®‰è£…è¿›åº¦

å½“å‰ç‰ˆæœ¬çš„ `quickstart.sh` å·²ç»æä¾›äº†è¯¦ç»†çš„è¿›åº¦æ˜¾ç¤ºï¼š

```
  â†’ æ­£åœ¨æ”¶é›†: torch                    [å·²è¿è¡Œ 120s]
  â¬‡ ä¸‹è½½ä¸­... [5 ä¸ªæ–‡ä»¶, 1800.5 MB å·²ä¸‹è½½, 15.0 MB/s]
  ðŸ”¨ ç¼–è¯‘ä¸­... (å·²ç”¨æ—¶ 300s)
```

å¦‚æžœçœ‹åˆ° **"æ”¶é›†"é˜¶æ®µå¡å¾ˆä¹…**ï¼š

- æ­£å¸¸ï¼špip æ­£åœ¨è§£æžä¾èµ–æ ‘ï¼ˆå¤æ‚åŒ…å¯èƒ½éœ€è¦ 1-5 åˆ†é’Ÿï¼‰
- å¼‚å¸¸ï¼šå¦‚æžœè¶…è¿‡ **10 åˆ†é’Ÿ**ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå»ºè®® Ctrl+C é‡è¯•

å¦‚æžœçœ‹åˆ° **"ç¼–è¯‘"é˜¶æ®µå¾ˆä¹…**ï¼š

- æ­£å¸¸ï¼šCUDA ç›¸å…³åŒ…ç¼–è¯‘éœ€è¦æ—¶é—´ï¼ˆ5-15 åˆ†é’Ÿï¼‰
- ä¼˜åŒ–ï¼šä½¿ç”¨é¢„ç¼–è¯‘çš„ wheel åŒ…ï¼ˆè§æ–¹æ¡ˆ 3ï¼‰

## æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1ï¼šæ”¶é›†é˜¶æ®µå¡ä½è¶…è¿‡ 10 åˆ†é’Ÿ

**åŽŸå› **ï¼šPyPI æœåŠ¡å™¨å“åº”æ…¢æˆ–ä¾èµ–è§£æžå¤æ‚

**è§£å†³**ï¼š

```bash
# 1. å¼ºåˆ¶ç»ˆæ­¢ï¼ˆCtrl+Cï¼‰
# 2. åˆ‡æ¢é•œåƒæº
export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple
# 3. é‡è¯•
./quickstart.sh --dev --yes --resume
```

### é—®é¢˜ 2ï¼šä¸‹è½½é€Ÿåº¦ < 0.5 MB/s

**åŽŸå› **ï¼šç½‘ç»œé—®é¢˜æˆ–æœªä½¿ç”¨é•œåƒæº

**è§£å†³**ï¼š

```bash
# 1. æµ‹è¯•ç½‘ç»œ
ping pypi.org
ping pypi.tuna.tsinghua.edu.cn

# 2. ä½¿ç”¨é•œåƒæºï¼ˆè§æ–¹æ¡ˆ 1ï¼‰
```

### é—®é¢˜ 3ï¼šç¼–è¯‘å¤±è´¥

**åŽŸå› **ï¼šç¼ºå°‘ç¼–è¯‘å·¥å…·æˆ– CUDA ç‰ˆæœ¬ä¸åŒ¹é…

**è§£å†³**ï¼š

```bash
# 1. å®‰è£…ç¼–è¯‘å·¥å…·
sudo apt-get update
sudo apt-get install -y build-essential cmake ninja-build

# 2. æ£€æŸ¥ CUDA ç‰ˆæœ¬
nvidia-smi  # æŸ¥çœ‹ CUDA ç‰ˆæœ¬

# 3. ä½¿ç”¨ CPU ç‰ˆæœ¬ï¼ˆå¦‚æžœä¸éœ€è¦ GPUï¼‰
export SAGE_DISABLE_GPU=1
./quickstart.sh --dev --yes
```

## æœªæ¥æ”¹è¿›è®¡åˆ’

æˆ‘ä»¬è®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å®žçŽ°ï¼š

1. **æ™ºèƒ½ä¾èµ–åˆ†ç»„**ï¼šè‡ªåŠ¨å°† 110 ä¸ªä¾èµ–åˆ†æˆ 3-5 ç»„ï¼Œåˆ†æ‰¹å¹¶è¡Œå®‰è£…
1. **ä¾èµ–ç¼“å­˜**ï¼šé¢„ä¸‹è½½å¸¸è§ä¾èµ–åˆ°æœ¬åœ°ç¼“å­˜
1. **å¿«é€Ÿå®‰è£…æ¨¡å¼**ï¼š`--fast` é€‰é¡¹ï¼Œä»…å®‰è£…æ ¸å¿ƒåŠŸèƒ½
1. **è¿›åº¦ä¼°ç®—**ï¼šåŸºäºŽç½‘ç»œé€Ÿåº¦ä¼°ç®—å‰©ä½™æ—¶é—´
1. **è‡ªåŠ¨é•œåƒé€‰æ‹©**ï¼šæ ¹æ®åœ°ç†ä½ç½®è‡ªåŠ¨é€‰æ‹©æœ€å¿«çš„é•œåƒæº

## æŽ¨èé…ç½®é€ŸæŸ¥è¡¨

| åœºæ™¯                 | å‘½ä»¤                                                                                           | é¢„æœŸæ—¶é—´  |
| -------------------- | ---------------------------------------------------------------------------------------------- | --------- |
| **å›½å†…ç”¨æˆ·ï¼ˆæŽ¨èï¼‰** | `export PIP_INDEX_URL=https://pypi.tuna.tsinghua.edu.cn/simple && ./quickstart.sh --dev --yes` | 10-15 min |
| **å›½å¤–ç”¨æˆ·**         | `export PIP_CONCURRENT_DOWNLOADS=8 && ./quickstart.sh --dev --yes`                             | 20-30 min |
| **æ–­ç‚¹ç»­ä¼ **         | `./quickstart.sh --dev --yes --resume`                                                         | 5-10 min  |
| **Conda ç”¨æˆ·**       | `./quickstart.sh --dev --yes --conda`                                                          | 15-20 min |
| **æœ€å¿«ï¼ˆç»„åˆï¼‰**     | è§"ç»„åˆä¼˜åŒ–"ç« èŠ‚                                                                               | 10-15 min |

## å½“å‰è¿›åº¦å»ºè®®

æ ¹æ®ä½ çš„æ—¥å¿—ï¼ˆå·²è¿è¡Œ 1984 ç§’ â‰ˆ 33 åˆ†é’Ÿï¼‰ï¼š

1. **ä¸è¦ä¸­æ–­**ï¼štorch/torchvision å¯èƒ½æ­£åœ¨ç¼–è¯‘ï¼Œä¸­æ–­ä¼šé‡æ–°å¼€å§‹
1. **æ£€æŸ¥è¿›åº¦**ï¼šçœ‹æ˜¯å¦æœ‰ "ðŸ”¨ ç¼–è¯‘ä¸­" çš„æç¤º
1. **ç­‰å¾…å®Œæˆ**ï¼šé¦–æ¬¡å®‰è£…é€šå¸¸éœ€è¦ 30-40 åˆ†é’Ÿ
1. **ä¸‹æ¬¡ä¼˜åŒ–**ï¼šå¦‚æžœéœ€è¦é‡æ–°å®‰è£…ï¼Œä½¿ç”¨ä¸Šè¿°é•œåƒæºé…ç½®

**å®žæ—¶ç›‘æŽ§å»ºè®®**ï¼š

```bash
# å¦å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œç›‘æŽ§ pip è¿›ç¨‹
watch -n 2 'ps aux | grep pip'

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
tail -f ~/.sage/logs/install.log
```

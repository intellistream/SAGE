#!/bin/bash
# SAGE å®‰è£…è„šæœ¬ - ç§‘å­¦è®¡ç®—åŒ…å®‰è£…å™¨
# è´Ÿè´£å®‰è£…ç§‘å­¦è®¡ç®—ç›¸å…³çš„ä¾èµ–åŒ…

# å¯¼å…¥é¢œè‰²å®šä¹‰
source "$(dirname "${BASH_SOURCE[0]}")/../display_tools/colors.sh"

# å¯¼å…¥æ ¸å¿ƒå®‰è£…å™¨å‡½æ•°
source "$(dirname "${BASH_SOURCE[0]}")/core_installer.sh"

# å®‰è£…ç§‘å­¦è®¡ç®—åŒ…
install_scientific_packages() {
    # èŽ·å–é¡¹ç›®æ ¹ç›®å½•å’Œæ—¥å¿—æ–‡ä»¶
    local project_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../../" && pwd)"
    local log_file="$project_root/install.log"
    
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${BOLD}  ðŸ”¬ æ­£åœ¨å®‰è£…ç§‘å­¦è®¡ç®—åº“...${NC}"
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$(date): å¼€å§‹å®‰è£…ç§‘å­¦è®¡ç®—åº“" >> "$log_file"
    
    local packages=(
        "numpy>=1.21.0"
        "pandas>=1.3.0" 
        "matplotlib>=3.4.0"
        "scipy>=1.7.0"
        "jupyter>=1.0.0"
        "ipykernel>=6.0.0"
    )
    
    for package in "${packages[@]}"; do
        echo -e "${BOLD}  ðŸ“Š æ­£åœ¨å®‰è£… $package${NC}"
        echo -e "${DIM}è¿è¡Œå‘½ä»¤: $PIP_CMD install $package${NC}"
        echo ""
        
        if install_pypi_package_with_output "$PIP_CMD" "$package"; then
            echo ""
            echo -e "${CHECK} $package å®‰è£…æˆåŠŸï¼"
            echo ""
        else
            echo ""
            echo -e "${WARNING} $package å®‰è£…å¯èƒ½å¤±è´¥ï¼Œç»§ç»­å®‰è£…å…¶ä»–åŒ…..."
            echo ""
        fi
    done
    
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}${BOLD}  ðŸŽ‰ ç§‘å­¦è®¡ç®—åº“å®‰è£…å®Œæˆï¼${NC}"
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$(date): ç§‘å­¦è®¡ç®—åº“å®‰è£…å®Œæˆ" >> "$log_file"
}

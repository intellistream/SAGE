#!/bin/bash
# SAGE å®‰è£…è„šæœ¬ - å¼€å‘å·¥å…·åŒ…å®‰è£…å™¨
# è´Ÿè´£å®‰è£…å¼€å‘å·¥å…·ç›¸å…³çš„ä¾èµ–åŒ…

# å¯¼å…¥é¢œè‰²å®šä¹‰
source "$(dirname "${BASH_SOURCE[0]}")/../display_tools/colors.sh"

# å¯¼å…¥æ ¸å¿ƒå®‰è£…å™¨å‡½æ•°
source "$(dirname "${BASH_SOURCE[0]}")/core_installer.sh"

# å®‰è£…å¼€å‘åŒ…
install_dev_packages() {
    # èŽ·å–é¡¹ç›®æ ¹ç›®å½•å’Œæ—¥å¿—æ–‡ä»¶
    local project_root="$(cd "$(dirname "${BASH_SOURCE[0]}")/../../../" && pwd)"
    local log_file="$project_root/install.log"
    
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${BOLD}  ðŸ› ï¸  æ­£åœ¨å®‰è£…å¼€å‘å·¥å…·...${NC}"
    echo -e "${BLUE}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo ""
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$(date): å¼€å§‹å®‰è£…å¼€å‘å·¥å…·" >> "$log_file"
    
    local dev_packages=(
        "pytest>=6.0.0"
        "pytest-cov>=2.12.0"
        "black>=21.0.0"
        "flake8>=3.9.0"
        "mypy>=0.910"
        "pre-commit>=2.15.0"
    )
    
    for package in "${dev_packages[@]}"; do
        echo -e "${BOLD}  ðŸ”§ æ­£åœ¨å®‰è£… $package${NC}"
        echo -e "${DIM}è¿è¡Œå‘½ä»¤: $PIP_CMD install $package${NC}"
        echo ""
        
        if install_pypi_package_with_output "$PIP_CMD" "$package"; then
            echo ""
            echo -e "${CHECK} $package å®‰è£…æˆåŠŸï¼"
            echo ""
        else
            echo ""
            echo -e "${WARNING} $package å®‰è£…å¯èƒ½å¤±è´¥ï¼Œç»§ç»­å®‰è£…å…¶ä»–åŒ…..."
            echo ""
        fi
    done
    
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    echo -e "${GREEN}${BOLD}  ðŸŽ‰ å¼€å‘å·¥å…·å®‰è£…å®Œæˆï¼${NC}"
    echo -e "${GREEN}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
    
    # è®°å½•åˆ°æ—¥å¿—
    echo "$(date): å¼€å‘å·¥å…·å®‰è£…å®Œæˆ" >> "$log_file"
}

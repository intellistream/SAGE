#!/bin/bash
#
# SAGE Framework æµ‹è¯•å…¥å£è„šæœ¬
# Main test entry script for SAGE Framework

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"

# é¢œè‰²è¾“å‡º
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

show_help() {
    cat << EOF
ğŸ§ª SAGE Framework æµ‹è¯•å·¥å…·

ä½¿ç”¨æ–¹æ³•:
  $0 <command> [options]

å‘½ä»¤:
  quick           å¿«é€Ÿæµ‹è¯•ä¸»è¦åŒ…
  all             æµ‹è¯•æ‰€æœ‰åŒ…
  diagnose        è¿è¡Œè¯Šæ–­å’ŒçŠ¶æ€æ£€æŸ¥
  packages PKG... æµ‹è¯•æŒ‡å®šåŒ…
  help            æ˜¾ç¤ºæ­¤å¸®åŠ©

å¿«é€Ÿå‘½ä»¤:
  $0 quick                    # å¿«é€Ÿæµ‹è¯•
  $0 all --summary            # æµ‹è¯•æ‰€æœ‰åŒ…ï¼Œæ˜¾ç¤ºæ‘˜è¦
  $0 diagnose                 # è¿è¡Œè¯Šæ–­
  $0 packages sage-libs       # æµ‹è¯•æŒ‡å®šåŒ…

è¯¦ç»†ç”¨æ³•è¯·å‚è€ƒ:
  - Python å·¥å…·: python $SCRIPT_DIR/run_tests.py --help
  - Bash å·¥å…·:   $SCRIPT_DIR/test_all_packages.sh --help
  - å¿«é€Ÿå·¥å…·:    $SCRIPT_DIR/quick_test.sh --help

EOF
}

case "${1:-help}" in
    quick|q)
        shift
        echo -e "${BLUE}ğŸš€ å¯åŠ¨å¿«é€Ÿæµ‹è¯•${NC}"
        exec python "$SCRIPT_DIR/run_tests.py" --quick "$@"
        ;;
    all|a)
        shift
        echo -e "${BLUE}ğŸ” å¯åŠ¨å…¨é¢æµ‹è¯•${NC}"
        exec python "$SCRIPT_DIR/run_tests.py" --all "$@"
        ;;
    diagnose|d)
        shift
        echo -e "${BLUE}ğŸ”§ å¯åŠ¨è¯Šæ–­æ£€æŸ¥${NC}"
        exec python "$SCRIPT_DIR/run_tests.py" --diagnose "$@"
        ;;
    packages|p)
        shift
        if [[ $# -eq 0 ]]; then
            echo -e "${YELLOW}è¯·æŒ‡å®šè¦æµ‹è¯•çš„åŒ…å${NC}"
            exit 1
        fi
        echo -e "${BLUE}ğŸ“¦ æµ‹è¯•æŒ‡å®šåŒ…: $*${NC}"
        exec python "$SCRIPT_DIR/run_tests.py" --packages "$@"
        ;;
    bash|b)
        shift
        echo -e "${BLUE}ğŸ”¨ ä½¿ç”¨ Bash æµ‹è¯•å·¥å…·${NC}"
        exec "$SCRIPT_DIR/test_all_packages.sh" "$@"
        ;;
    help|h|--help|-h)
        show_help
        ;;
    *)
        echo -e "${YELLOW}æœªçŸ¥å‘½ä»¤: $1${NC}"
        show_help
        exit 1
        ;;
esac

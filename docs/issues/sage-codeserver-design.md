# SAGE æºä»£ç æœåŠ¡å™¨ (SAGE CodeServer) è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ èƒŒæ™¯ä¸ç›®æ ‡

SAGEé¡¹ç›®åœ¨ `scripts/` ç›®å½•ä¸­ç§¯ç´¯äº†å¤šä¸ªé«˜è´¨é‡çš„æºä»£ç åˆ†æå’Œç®¡ç†å·¥å…·ï¼ŒåŒ…æ‹¬ï¼š

- **æµ‹è¯•å·¥å…·**: `test_runner.py` - æ™ºèƒ½æµ‹è¯•è¿è¡Œå™¨ï¼Œæ”¯æŒå¹¶è¡Œæµ‹è¯•å’Œå·®å¼‚åŒ–æµ‹è¯•
- **ä¾èµ–åˆ†æ**: `advanced_dependency_analyzer_with_sage_mapping.py` - é«˜çº§ä¾èµ–å…³ç³»åˆ†æå™¨
- **åŒ…ç®¡ç†**: `sage-package-manager.py` - åŒ…ç®¡ç†å’Œå®‰è£…å·¥å…·
- **ä»£ç æ£€æŸ¥**: `check_package_dependencies.py` - åŒ…ä¾èµ–æ£€æŸ¥å·¥å…·
- **å¼€å‘å·¥å…·**: `setup-ide-support.py` - IDEæ”¯æŒé…ç½®å·¥å…·

ç›®å‰è¿™äº›å·¥å…·ç›¸äº’ç‹¬ç«‹ï¼Œç¼ºä¹ç»Ÿä¸€çš„å…¥å£å’Œåè°ƒæœºåˆ¶ã€‚æˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª**SAGEæºä»£ç æœåŠ¡å™¨**ï¼Œå°†è¿™äº›åŠŸèƒ½æ•´åˆæˆä¸€ä¸ªç»Ÿä¸€çš„WebæœåŠ¡ï¼Œæä¾›ï¼š

- ğŸš€ ä¸€é”®æµ‹è¯•è¿è¡Œå’ŒæŠ¥å‘Šç”Ÿæˆ
- ğŸ“Š å®æ—¶ä¾èµ–å…³ç³»åˆ†æå’Œå¯è§†åŒ–
- ğŸ“¦ åŒ…ç®¡ç†å’Œæ„å»ºçŠ¶æ€ç›‘æ§
- ğŸ” ä»£ç è´¨é‡æ£€æŸ¥å’Œå»ºè®®
- ğŸ“ˆ æŒç»­é›†æˆæ”¯æŒå’Œå†å²è¿½è¸ª

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
SAGE CodeServer
â”œâ”€â”€ ğŸŒ Web API Server (FastAPI)
â”‚   â”œâ”€â”€ /api/test        - æµ‹è¯•ç®¡ç†API
â”‚   â”œâ”€â”€ /api/analysis    - ä¾èµ–åˆ†æAPI  
â”‚   â”œâ”€â”€ /api/packages    - åŒ…ç®¡ç†API
â”‚   â”œâ”€â”€ /api/status      - ç³»ç»ŸçŠ¶æ€API
â”‚   â””â”€â”€ /api/reports     - æŠ¥å‘Šç”ŸæˆAPI
â”‚
â”œâ”€â”€ ğŸ–¥ï¸ Web Dashboard (React/Vue)
â”‚   â”œâ”€â”€ æµ‹è¯•ä¸­å¿ƒ        - è¿è¡Œæµ‹è¯•ã€æŸ¥çœ‹ç»“æœ
â”‚   â”œâ”€â”€ ä¾èµ–å›¾è°±        - å¯è§†åŒ–ä¾èµ–å…³ç³»
â”‚   â”œâ”€â”€ åŒ…ç®¡ç†ä¸­å¿ƒ      - åŒ…çŠ¶æ€ã€æ„å»ºç›‘æ§
â”‚   â”œâ”€â”€ ä»£ç è´¨é‡        - è´¨é‡æ£€æŸ¥æŠ¥å‘Š
â”‚   â””â”€â”€ ç³»ç»Ÿç›‘æ§        - èµ„æºä½¿ç”¨ã€å†å²æ•°æ®
â”‚
â”œâ”€â”€ ğŸ”§ Task Engine (Celery/RQ)
â”‚   â”œâ”€â”€ æµ‹è¯•ä»»åŠ¡è°ƒåº¦
â”‚   â”œâ”€â”€ ä¾èµ–åˆ†æä»»åŠ¡
â”‚   â”œâ”€â”€ åŒ…æ„å»ºä»»åŠ¡
â”‚   â””â”€â”€ æŠ¥å‘Šç”Ÿæˆä»»åŠ¡
â”‚
â”œâ”€â”€ ğŸ’¾ Data Layer
â”‚   â”œâ”€â”€ SQLite/PostgreSQL - å­˜å‚¨åˆ†æç»“æœ
â”‚   â”œâ”€â”€ Redis - ä»»åŠ¡é˜Ÿåˆ—å’Œç¼“å­˜
â”‚   â””â”€â”€ æ–‡ä»¶å­˜å‚¨ - æµ‹è¯•æŠ¥å‘Šã€æ—¥å¿—æ–‡ä»¶
â”‚
â””â”€â”€ ğŸ§© Tool Integrations
    â”œâ”€â”€ TestRunner - é›†æˆç°æœ‰test_runner.py
    â”œâ”€â”€ DependencyAnalyzer - é›†æˆä¾èµ–åˆ†æå™¨
    â”œâ”€â”€ PackageManager - é›†æˆåŒ…ç®¡ç†å™¨
    â””â”€â”€ CodeChecker - é›†æˆä»£ç æ£€æŸ¥å·¥å…·
```

### æŠ€æœ¯æ ˆé€‰æ‹©

**åç«¯æŠ€æœ¯æ ˆ:**
- **FastAPI** - ç°ä»£Python Webæ¡†æ¶ï¼Œè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£
- **Celery + Redis** - å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œå¤„ç†è€—æ—¶æ“ä½œ
- **SQLAlchemy + SQLite/PostgreSQL** - ORMå’Œæ•°æ®å­˜å‚¨
- **Pydantic** - æ•°æ®éªŒè¯å’Œåºåˆ—åŒ–

**å‰ç«¯æŠ€æœ¯æ ˆ:**
- **React + TypeScript** - ç°ä»£å‰ç«¯æ¡†æ¶
- **Ant Design/Material-UI** - UIç»„ä»¶åº“
- **D3.js/Vis.js** - ä¾èµ–å…³ç³»å›¾å¯è§†åŒ–
- **Chart.js** - æ•°æ®å›¾è¡¨å±•ç¤º

## ğŸš€ åŠŸèƒ½ç‰¹æ€§è®¾è®¡

### 1. æµ‹è¯•ä¸­å¿ƒ (Test Center)

**åŠŸèƒ½ç‰¹æ€§:**
- âœ… ä¸€é”®è¿è¡Œå…¨é‡æµ‹è¯•æˆ–æ™ºèƒ½å·®å¼‚æµ‹è¯•
- âœ… å®æ—¶æ˜¾ç¤ºæµ‹è¯•è¿›åº¦å’Œç»“æœ
- âœ… æ”¯æŒåŒ…çº§åˆ«å’Œæ–‡ä»¶çº§åˆ«çš„æµ‹è¯•é€‰æ‹©
- âœ… æµ‹è¯•å†å²è®°å½•å’Œè¶‹åŠ¿åˆ†æ
- âœ… å¤±è´¥æµ‹è¯•çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

**APIè®¾è®¡:**
```python
POST /api/test/run
{
    "type": "all|diff|package",
    "target": "sage-kernel",  # å¯é€‰ï¼ŒæŒ‡å®šåŒ…å
    "base_branch": "main",  # diffæ¨¡å¼çš„åŸºå‡†åˆ†æ”¯
    "parallel_workers": 4
}

GET /api/test/status/{task_id}
GET /api/test/results/{task_id}
GET /api/test/history?package=sage-kernel&limit=50
```

### 2. ä¾èµ–åˆ†æä¸­å¿ƒ (Dependency Analysis)

**åŠŸèƒ½ç‰¹æ€§:**
- ğŸ“Š å®æ—¶ç”ŸæˆåŒ…ä¾èµ–å…³ç³»å›¾
- ğŸ” æ£€æµ‹å¾ªç¯ä¾èµ–å’Œæ½œåœ¨é—®é¢˜
- ğŸ“ˆ åˆ†æä¾èµ–å¥åº·åº¦å’Œå¤æ‚åº¦
- ğŸ¯ æä¾›é‡æ„å»ºè®®å’Œä¼˜åŒ–æ–¹æ¡ˆ
- ğŸ“‹ å¯¼å‡ºå¤šç§æ ¼å¼çš„åˆ†ææŠ¥å‘Š

**å¯è§†åŒ–åŠŸèƒ½:**
- äº¤äº’å¼ä¾èµ–å…³ç³»å›¾ï¼ˆæ”¯æŒç¼©æ”¾ã€è¿‡æ»¤ï¼‰
- åŒ…ç»“æ„æ ‘çŠ¶å›¾
- å¾ªç¯ä¾èµ–é«˜äº®æ˜¾ç¤º
- ä¾èµ–æ·±åº¦çƒ­åŠ›å›¾

**APIè®¾è®¡:**
```python
POST /api/analysis/dependencies
{
    "scope": "all|package",
    "package": "sage-kernel",  # å¯é€‰
    "include_external": true
}

GET /api/analysis/circular-deps
GET /api/analysis/graph-data?format=json|graphml
```

### 3. åŒ…ç®¡ç†ä¸­å¿ƒ (Package Management)

**åŠŸèƒ½ç‰¹æ€§:**
- ğŸ“¦ æ˜¾ç¤ºæ‰€æœ‰åŒ…çš„çŠ¶æ€å’Œç‰ˆæœ¬ä¿¡æ¯
- ğŸ”§ ä¸€é”®å®‰è£…ã€æ„å»ºã€æ¸…ç†åŒ…
- ğŸ“‹ åŒ…ä¾èµ–å…³ç³»æ ‘æ˜¾ç¤º
- ğŸš€ æ”¯æŒæ‰¹é‡æ“ä½œå’Œæ„å»ºæµæ°´çº¿
- ğŸ“Š æ„å»ºå†å²å’Œæ€§èƒ½ç›‘æ§

**APIè®¾è®¡:**
```python
GET /api/packages/list
POST /api/packages/install
{
    "packages": ["sage-kernel", "sage-utils"],
    "mode": "development|production"
}

POST /api/packages/build/{package_name}
GET /api/packages/status/{package_name}
```

### 4. ä»£ç è´¨é‡ä¸­å¿ƒ (Code Quality)

**åŠŸèƒ½ç‰¹æ€§:**
- ğŸ” é™æ€ä»£ç åˆ†æï¼ˆé›†æˆpylintã€mypyã€blackï¼‰
- ğŸ“ ä»£ç å¤æ‚åº¦å’Œè¦†ç›–ç‡ç»Ÿè®¡
- ğŸ¯ ä»£ç è§„èŒƒæ£€æŸ¥å’Œè‡ªåŠ¨ä¿®å¤å»ºè®®
- ğŸ“ˆ è´¨é‡è¶‹åŠ¿åˆ†æå’Œå†å²å¯¹æ¯”
- ğŸš¨ è´¨é‡é—®é¢˜é¢„è­¦å’Œé€šçŸ¥

### 5. ç³»ç»Ÿç›‘æ§ (System Monitoring)

**åŠŸèƒ½ç‰¹æ€§:**
- ğŸ“Š å®æ—¶ç³»ç»Ÿèµ„æºç›‘æ§ï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ï¼‰
- ğŸ“ˆ ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡å’Œæ€§èƒ½åˆ†æ
- ğŸ”” å¼‚å¸¸æƒ…å†µæŠ¥è­¦å’Œé€šçŸ¥
- ğŸ“‹ æ“ä½œå®¡è®¡æ—¥å¿—
- ğŸ¯ æ€§èƒ½ä¼˜åŒ–å»ºè®®

## ğŸ› ï¸ å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒæ¡†æ¶æ­å»º (Week 1-2)
- [ ] FastAPIæœåŠ¡å™¨åŸºç¡€æ¶æ„
- [ ] æ•°æ®åº“æ¨¡å‹è®¾è®¡å’Œè¿ç§»
- [ ] ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿé›†æˆ
- [ ] åŸºç¡€Webç•Œé¢æ¡†æ¶

### Phase 2: æµ‹è¯•ä¸­å¿ƒå®ç° (Week 3-4)
- [ ] é›†æˆç°æœ‰test_runner.py
- [ ] æµ‹è¯•ä»»åŠ¡APIå’Œè°ƒåº¦
- [ ] æµ‹è¯•ç»“æœå­˜å‚¨å’ŒæŸ¥è¯¢
- [ ] æµ‹è¯•ä¸­å¿ƒå‰ç«¯ç•Œé¢

### Phase 3: ä¾èµ–åˆ†æåŠŸèƒ½ (Week 5-6)
- [ ] é›†æˆdependency_analyzer
- [ ] ä¾èµ–å…³ç³»å›¾ç”ŸæˆAPI
- [ ] å¯è§†åŒ–ç»„ä»¶å¼€å‘
- [ ] å¾ªç¯ä¾èµ–æ£€æµ‹å’ŒæŠ¥å‘Š

### Phase 4: åŒ…ç®¡ç†é›†æˆ (Week 7-8)
- [ ] é›†æˆsage-package-manager
- [ ] åŒ…æ“ä½œAPIå’Œç•Œé¢
- [ ] æ„å»ºçŠ¶æ€ç›‘æ§
- [ ] æ‰¹é‡æ“ä½œæ”¯æŒ

### Phase 5: ä»£ç è´¨é‡å’Œç›‘æ§ (Week 9-10)
- [ ] ä»£ç è´¨é‡æ£€æŸ¥é›†æˆ
- [ ] ç³»ç»Ÿç›‘æ§åŠŸèƒ½
- [ ] æŠ¥å‘Šç”Ÿæˆå’Œå¯¼å‡º
- [ ] é€šçŸ¥å’Œé¢„è­¦ç³»ç»Ÿ

### Phase 6: ä¼˜åŒ–å’Œéƒ¨ç½² (Week 11-12)
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•
- [ ] Dockerå®¹å™¨åŒ–éƒ¨ç½²
- [ ] CI/CDé›†æˆé…ç½®
- [ ] æ–‡æ¡£å’Œç”¨æˆ·æŒ‡å—

## ğŸ“ é¡¹ç›®ç»“æ„

```
packages/sage-codeserver/
â”œâ”€â”€ src/sage/codeserver/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/                 # FastAPIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test.py         # æµ‹è¯•ç›¸å…³API
â”‚   â”‚   â”œâ”€â”€ analysis.py     # ä¾èµ–åˆ†æAPI
â”‚   â”‚   â”œâ”€â”€ packages.py     # åŒ…ç®¡ç†API
â”‚   â”‚   â””â”€â”€ monitoring.py   # ç›‘æ§API
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_runner.py  # æµ‹è¯•è¿è¡Œæ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ analyzer.py     # ä¾èµ–åˆ†ææ ¸å¿ƒ
â”‚   â”‚   â””â”€â”€ package_mgr.py  # åŒ…ç®¡ç†æ ¸å¿ƒ
â”‚   â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test.py
â”‚   â”‚   â”œâ”€â”€ analysis.py
â”‚   â”‚   â””â”€â”€ package.py
â”‚   â”œâ”€â”€ tasks/              # å¼‚æ­¥ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_tasks.py
â”‚   â”‚   â””â”€â”€ analysis_tasks.py
â”‚   â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ integrations.py # ç°æœ‰å·¥å…·é›†æˆ
â”‚   â”‚   â””â”€â”€ helpers.py
â”‚   â””â”€â”€ static/             # é™æ€èµ„æº
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ css/
â”‚       â””â”€â”€ js/
â”œâ”€â”€ tests/                  # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docker/                 # Dockeré…ç½®
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”œâ”€â”€ requirements.txt
â””â”€â”€ pyproject.toml
```

## ğŸ¯ ä»·å€¼ä¸æ•ˆç›Š

### å¼€å‘æ•ˆç‡æå‡
- **ç»Ÿä¸€å…¥å£**: ä¸€ä¸ªç•Œé¢ç®¡ç†æ‰€æœ‰å¼€å‘å·¥å…·
- **è‡ªåŠ¨åŒ–**: å‡å°‘æ‰‹åŠ¨æ‰§è¡Œé‡å¤ä»»åŠ¡çš„æ—¶é—´
- **å¯è§†åŒ–**: ç›´è§‚å±•ç¤ºé¡¹ç›®çŠ¶æ€å’Œé—®é¢˜

### ä»£ç è´¨é‡ä¿éšœ
- **æŒç»­ç›‘æ§**: å®æ—¶å‘ç°ä»£ç è´¨é‡é—®é¢˜
- **è¶‹åŠ¿åˆ†æ**: è·Ÿè¸ªè´¨é‡å˜åŒ–è¶‹åŠ¿
- **æ™ºèƒ½å»ºè®®**: æä¾›æ”¹è¿›å»ºè®®å’Œæœ€ä½³å®è·µ

### å›¢é˜Ÿåä½œå¢å¼º
- **ç»Ÿä¸€æ ‡å‡†**: æ ‡å‡†åŒ–çš„æµ‹è¯•å’Œåˆ†ææµç¨‹
- **é€æ˜åº¦**: é¡¹ç›®çŠ¶æ€å¯¹æ‰€æœ‰æˆå‘˜å¯è§
- **çŸ¥è¯†å…±äº«**: é›†ä¸­åŒ–çš„å·¥å…·å’Œæ–‡æ¡£

## ğŸ”® æœªæ¥æ‰©å±•æ–¹å‘

1. **AIè¾…åŠ©**: é›†æˆLLMè¿›è¡Œä»£ç å®¡æŸ¥å’Œé‡æ„å»ºè®®
2. **å¤šé¡¹ç›®æ”¯æŒ**: æ”¯æŒç®¡ç†å¤šä¸ªç›¸å…³é¡¹ç›®
3. **æ’ä»¶ç³»ç»Ÿ**: å…è®¸ç¬¬ä¸‰æ–¹å·¥å…·é›†æˆ
4. **ç§»åŠ¨ç«¯**: å¼€å‘ç§»åŠ¨ç«¯ç›‘æ§åº”ç”¨
5. **äº‘ç«¯éƒ¨ç½²**: æ”¯æŒäº‘åŸç”Ÿéƒ¨ç½²å’Œæ‰©å±•

---

**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜ä¼˜å…ˆçº§
**é¢„ä¼°å·¥æœŸ**: 12å‘¨
**è´Ÿè´£äºº**: å¾…åˆ†é…
**æ ‡ç­¾**: `enhancement`, `tooling`, `infrastructure`, `web-service`

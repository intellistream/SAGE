# PR æ™ºèƒ½æµ‹è¯• Workflow

## æ¦‚è¿°

æ–°çš„ `PR Intelligence Testing` workflow å·²ç»æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œå®ƒä½¿ç”¨ `scripts/test_runner.py --diff` åŠŸèƒ½ä¸º Pull Request æä¾›æ™ºèƒ½ã€é«˜æ•ˆçš„æµ‹è¯•ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ æ™ºèƒ½æµ‹è¯•é€‰æ‹©
- **åŸºäº git diff**: è‡ªåŠ¨åˆ†æ PR ä¸­çš„å˜åŒ–æ–‡ä»¶
- **é€’å½’æµ‹è¯•å‘ç°**: æŸ¥æ‰¾å˜åŒ–æ–‡ä»¶çš„çˆ¶ç›®å½•ä¸­çš„æµ‹è¯•
- **åªè¿è¡Œç›¸å…³æµ‹è¯•**: é¿å…è¿è¡Œä¸ç›¸å…³çš„æµ‹è¯•ï¼ŒèŠ‚çœæ—¶é—´

### âš¡ å¹¶è¡Œæ‰§è¡Œ
- **å¤šè¿›ç¨‹è¿è¡Œ**: ä½¿ç”¨ 2 ä¸ªå¹¶è¡Œ worker æ‰§è¡Œæµ‹è¯•
- **å®æ—¶è¿›åº¦**: æ˜¾ç¤ºæµ‹è¯•æ‰§è¡Œè¿›åº¦
- **ç»“æ„åŒ–æ—¥å¿—**: æ¯ä¸ªæµ‹è¯•ç›®å½•ç”Ÿæˆç‹¬ç«‹çš„æ—¥å¿—æ–‡ä»¶

### ğŸ“Š æ™ºèƒ½æŠ¥å‘Š
- **PR è¯„è®º**: è‡ªåŠ¨åœ¨ PR ä¸­å‘å¸ƒæµ‹è¯•ç»“æœè¯„è®º
- **çŠ¶æ€æ›´æ–°**: è¯„è®ºä¼šéšç€æ–°çš„æµ‹è¯•è¿è¡Œè‡ªåŠ¨æ›´æ–°
- **è¯¦ç»†æ‘˜è¦**: æ˜¾ç¤ºæµ‹è¯•æ•°é‡ã€æˆåŠŸ/å¤±è´¥çŠ¶æ€ç­‰

## è§¦å‘æ¡ä»¶

è¯¥ workflow åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è‡ªåŠ¨è¿è¡Œï¼š

```yaml
on:
  pull_request:
    branches: [ main, develop, v*.*.* ]
    types: [opened, synchronize, reopened, ready_for_review]
```

- âœ… æ–°å»º PR
- âœ… PR æœ‰æ–°çš„æäº¤
- âœ… PR é‡æ–°æ‰“å¼€
- âœ… è‰ç¨¿ PR æ ‡è®°ä¸ºå¯å®¡æ ¸
- âŒ è‰ç¨¿ PRï¼ˆè‡ªåŠ¨è·³è¿‡ï¼‰

## å·¥ä½œæµç¨‹

1. **æ£€å‡ºä»£ç **: è·å– PR ä»£ç å’Œå®Œæ•´ git å†å²
2. **ç¯å¢ƒè®¾ç½®**: å®‰è£… Python 3.11 å’Œä¾èµ–
3. **æ™ºèƒ½åˆ†æ**: ä½¿ç”¨ `test_runner.py --diff` åˆ†æå˜åŒ–
4. **æ‰§è¡Œæµ‹è¯•**: å¹¶è¡Œè¿è¡Œç›¸å…³æµ‹è¯•
5. **æ”¶é›†ç»“æœ**: ä¸Šä¼ æµ‹è¯•æ—¥å¿—å’Œç”ŸæˆæŠ¥å‘Š
6. **æ›´æ–° PR**: åœ¨ PR ä¸­å‘å¸ƒ/æ›´æ–°æµ‹è¯•ç»“æœè¯„è®º

## æµ‹è¯•è¾“å‡ºç¤ºä¾‹

### æˆåŠŸæƒ…å†µ
```
## âœ… Intelligent Testing Results

**Status: PASSED**

### ğŸ“Š Test Summary
- **Changed files analyzed**: 3
- **Testing strategy**: Diff-based intelligent selection
- **Base comparison**: `main`
- **Parallel workers**: 2
- **Tool**: `scripts/test_runner.py --diff`

### ğŸ‰ Ready for review!
All tests affected by your changes have passed successfully!
```

### å¤±è´¥æƒ…å†µ
```
## âŒ Intelligent Testing Results

**Status: FAILED**

### âš ï¸ Needs attention
Some tests failed. Please check the workflow logs and fix the issues.
```

### æ— å˜åŒ–æƒ…å†µ
```
## â„¹ï¸ Intelligent Testing Results

**Status: SKIPPED**

### âœ… Result
No tests needed to run - your PR appears to have no functional changes.
```

## æµ‹è¯•æ—¥å¿—

- **å·¥ä»¶ä¿ç•™**: æµ‹è¯•æ—¥å¿—ä½œä¸º GitHub Actions å·¥ä»¶ä¿å­˜ 14 å¤©
- **æ–‡ä»¶å‘½å**: `intelligent-test-logs-{PR-number}`
- **ç»“æ„åŒ–æ—¥å¿—**: æ¯ä¸ªæµ‹è¯•ç›®å½•ä¸€ä¸ª `.log` æ–‡ä»¶

## ä¸ç°æœ‰ Workflow çš„å…³ç³»

è¿™ä¸ªæ–°çš„ workflow ä¸“é—¨é’ˆå¯¹ PR åœºæ™¯ï¼Œä¸ç°æœ‰çš„æµ‹è¯• workflow å½¢æˆäº’è¡¥ï¼š

- `pr-intelligent-testing.yml`: PR ä¸“ç”¨ï¼Œä½¿ç”¨ `test_runner.py --diff`
- `smart-testing.yml`: é€šç”¨æ™ºèƒ½æµ‹è¯•ï¼Œä½¿ç”¨å†…ç½®é€»è¾‘
- `ci.yml`: å®Œæ•´ CI æµç¨‹ï¼ˆå½“å‰å·²æ³¨é‡Šï¼‰

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
workflow ç»§æ‰¿äº†é¡¹ç›®çš„æ ‡å‡†ç¯å¢ƒå˜é‡ï¼š
- `HF_TOKEN`, `OPENAI_API_KEY` ç­‰ API å¯†é’¥
- `CI=true` æ ‡å¿— CI ç¯å¢ƒ
- `PYTHONPATH` è®¾ç½®ä¸ºå·¥ä½œåŒºè·¯å¾„

### è¶…æ—¶è®¾ç½®
- **æ€»è¶…æ—¶**: 45 åˆ†é’Ÿ
- **æµ‹è¯•è¶…æ—¶**: `test_runner.py` å†…ç½® 10 åˆ†é’Ÿå•æµ‹è¯•è¶…æ—¶

### ä¾èµ–å¤„ç†
- ä¼˜é›…å¤„ç† `requirements.txt` å®‰è£…å¤±è´¥
- å®¹å¿é¡¹ç›® `pip install -e .` å¤±è´¥
- ç¡®ä¿æ ¸å¿ƒæµ‹è¯•å·¥å…·ï¼ˆpytest, tqdmï¼‰å§‹ç»ˆå¯ç”¨

## ä½¿ç”¨å»ºè®®

1. **ç¡®ä¿æµ‹è¯•æ–‡ä»¶å­˜åœ¨**: workflow ä¼šæ£€æŸ¥ `scripts/test_runner.py` å­˜åœ¨
2. **åˆç†ç»„ç»‡æµ‹è¯•**: å°†æµ‹è¯•æ–‡ä»¶æ”¾åœ¨æºç é™„è¿‘çš„ `test/` æˆ– `tests/` ç›®å½•
3. **å…³æ³¨ PR è¯„è®º**: æµ‹è¯•ç»“æœä¼šè‡ªåŠ¨æ›´æ–°åœ¨ PR è¯„è®ºä¸­
4. **æŸ¥çœ‹å·¥ä»¶æ—¥å¿—**: å¤±è´¥æ—¶å¯ä¸‹è½½æµ‹è¯•æ—¥å¿—è¿›è¡Œè¯¦ç»†åˆ†æ

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **test_runner.py ä¸å­˜åœ¨**
   - ç¡®ä¿ `scripts/test_runner.py` æ–‡ä»¶å·²æäº¤
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„å’Œæƒé™

2. **æ²¡æœ‰å‘ç°æµ‹è¯•**
   - ç¡®ä¿å˜åŒ–çš„æ–‡ä»¶é™„è¿‘æœ‰ `test/` æˆ– `tests/` ç›®å½•
   - æ£€æŸ¥æµ‹è¯•æ–‡ä»¶å‘½åç¬¦åˆ `test_*.py` æˆ– `*_test.py`

3. **ä¾èµ–å®‰è£…å¤±è´¥**
   - æ£€æŸ¥ `requirements.txt` æ ¼å¼
   - æŸäº›ä¾èµ–å¤±è´¥ä¸ä¼šé˜»æ­¢æµ‹è¯•è¿è¡Œ

4. **è¶…æ—¶é—®é¢˜**
   - å•ä¸ªæµ‹è¯•ç›®å½•è¶…æ—¶æ—¶é—´: 10 åˆ†é’Ÿ
   - æ•´ä¸ª workflow è¶…æ—¶: 45 åˆ†é’Ÿ
   - è€ƒè™‘å‡å°‘ `--workers` æ•°é‡æˆ–ä¼˜åŒ–æµ‹è¯•

### è°ƒè¯•å»ºè®®

1. æŸ¥çœ‹ GitHub Actions æ—¥å¿—ä¸­çš„è¯¦ç»†è¾“å‡º
2. ä¸‹è½½æµ‹è¯•å·¥ä»¶æŸ¥çœ‹å…·ä½“çš„æµ‹è¯•æ—¥å¿—
3. æœ¬åœ°è¿è¡Œ `python scripts/test_runner.py --diff --base origin/main` é‡ç°é—®é¢˜
4. ä½¿ç”¨ `python scripts/test_runner.py --list` æŸ¥çœ‹æ‰€æœ‰å¯ç”¨æµ‹è¯•ç›®å½•

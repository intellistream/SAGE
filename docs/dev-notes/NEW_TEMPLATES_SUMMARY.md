# æ–°å¢åº”ç”¨æ¨¡æ¿æ€»ç»“

## ğŸ“‹ æ¦‚è¿°

åŸºäº `examples/` ç›®å½•ä¸‹çš„åº”ç”¨ç¤ºä¾‹ï¼Œæ–°å¢äº† **6 ä¸ªé«˜è´¨é‡åº”ç”¨æ¨¡æ¿**ï¼Œä¸°å¯Œäº† SAGE Pipeline Builder çš„æ¨¡æ¿åº“ï¼Œä½¿ LLM èƒ½å¤Ÿæ›´å‡†ç¡®åœ°ä¸ºå¤æ‚åº”ç”¨åœºæ™¯ç”Ÿæˆé…ç½®ã€‚

## âœ¨ æ–°å¢æ¨¡æ¿åˆ—è¡¨

### 1. **Milvus å¯†é›†å‘é‡æ£€ç´¢é—®ç­”** (`rag-dense-milvus`)

**åœºæ™¯**: ç”Ÿäº§çº§å¤§è§„æ¨¡è¯­ä¹‰æ£€ç´¢ç³»ç»Ÿ

**ç‰¹ç‚¹**:
- ä½¿ç”¨ Milvus å‘é‡æ•°æ®åº“è¿›è¡Œå¯†é›†å‘é‡æ£€ç´¢
- æ”¯æŒç™¾ä¸‡çº§æ–‡æ¡£çš„é«˜æ•ˆæ£€ç´¢
- æ”¯æŒ BGE ç­‰å¤šç§åµŒå…¥æ¨¡å‹
- é€‚åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**æ ‡ç­¾**: `rag`, `qa`, `milvus`, `dense`, `vector`, `embedding`, `å‘é‡æ£€ç´¢`, `å‘é‡æ•°æ®åº“`, `ç”Ÿäº§ç¯å¢ƒ`, `è¯­ä¹‰æœç´¢`

**ç¤ºä¾‹è·¯å¾„**: `examples/rag/qa_dense_retrieval_milvus.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `JSONLBatch` - JSONL æ‰¹å¤„ç†æ•°æ®æº
- Stage 1: `MilvusDenseRetriever` - Milvus å¯†é›†å‘é‡æ£€ç´¢å™¨
- Stage 2: `QAPromptor` - é—®ç­”æç¤ºè¯æ„å»ºå™¨
- Stage 3: `OpenAIGenerator` - LLM ç­”æ¡ˆç”Ÿæˆå™¨
- Sink: `TerminalSink` - ç»ˆç«¯è¾“å‡º

---

### 2. **é‡æ’åºå¢å¼ºæ£€ç´¢é—®ç­”** (`rag-rerank`)

**åœºæ™¯**: é«˜ç²¾åº¦è¦æ±‚çš„é—®ç­”ç³»ç»Ÿ

**ç‰¹ç‚¹**:
- ä¸¤é˜¶æ®µæ£€ç´¢æ¶æ„ï¼šç²—æ’å¬å› + ç²¾ç»†é‡æ’
- ç¬¬ä¸€é˜¶æ®µå¬å›æ›´å¤šå€™é€‰ï¼ˆå¦‚ top-20ï¼‰
- ç¬¬äºŒé˜¶æ®µä½¿ç”¨ BGE cross-encoder é‡æ’åºï¼ˆå¦‚ top-5ï¼‰
- æ˜¾è‘—æå‡æ£€ç´¢ç²¾ç¡®åº¦

**æ ‡ç­¾**: `rag`, `qa`, `rerank`, `reranker`, `precision`, `é‡æ’åº`, `ç²¾ç¡®åº¦`, `ä¸¤é˜¶æ®µ`, `å¬å›`, `ç²¾æ’`

**ç¤ºä¾‹è·¯å¾„**: `examples/rag/qa_rerank.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `JSONLBatch`
- Stage 1: `ChromaRetriever` - Chroma å‘é‡æ£€ç´¢ï¼ˆå¬å›é˜¶æ®µï¼‰
- Stage 2: `BGEReranker` - BGE é‡æ’åºå™¨ï¼ˆç²¾æ’é˜¶æ®µï¼‰
- Stage 3: `QAPromptor` - æç¤ºè¯æ„å»º
- Stage 4: `OpenAIGenerator` - LLM ç”Ÿæˆ
- Sink: `TerminalSink`

**é€‚ç”¨åœºæ™¯**: æ³•å¾‹ã€åŒ»ç–—ã€é‡‘èç­‰é«˜ç²¾åº¦é—®ç­”

---

### 3. **BM25 å…³é”®è¯æ£€ç´¢é—®ç­”** (`rag-bm25-sparse`)

**åœºæ™¯**: ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢ï¼Œæ— éœ€å‘é‡åŒ–

**ç‰¹ç‚¹**:
- åŸºäº BM25 ç®—æ³•çš„è¯æ³•åŒ¹é…
- æ— éœ€ GPU å’Œå‘é‡åŒ–
- è®¡ç®—æˆæœ¬ä½
- é€‚åˆç²¾ç¡®å…³é”®è¯åŒ¹é…
- å¯ä¸å¯†é›†æ£€ç´¢ç»“åˆå½¢æˆæ··åˆæ£€ç´¢

**æ ‡ç­¾**: `rag`, `qa`, `bm25`, `sparse`, `keyword`, `å…³é”®è¯`, `ç¨€ç–æ£€ç´¢`, `è¯æ³•`, `ä¼ ç»Ÿæ£€ç´¢`

**ç¤ºä¾‹è·¯å¾„**: `examples/rag/qa_bm25_retrieval.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `FileSource` - æ–‡ä»¶æ•°æ®æº
- Stage 1: `BM25sRetriever` - BM25 æ£€ç´¢å™¨
- Stage 2: `QAPromptor`
- Stage 3: `OpenAIGenerator`
- Sink: `TerminalSink`

**ä¼˜åŠ¿**: 
- ä¸“æœ‰åè¯å’Œç²¾ç¡®åŒ¹é…è¡¨ç°ä¼˜å¼‚
- èµ„æºå—é™ç¯å¢ƒå‹å¥½

---

### 4. **LLM æ™ºèƒ½ä½“å·¥ä½œæµ** (`agent-workflow`)

**åœºæ™¯**: è‡ªä¸»è§„åˆ’å’Œæ‰§è¡Œå¤æ‚ä»»åŠ¡çš„æ™ºèƒ½ä½“ç³»ç»Ÿ

**ç‰¹ç‚¹**:
- LLM è‡ªä¸»ä»»åŠ¡è§„åˆ’
- Model Context Protocol (MCP) å·¥å…·è°ƒç”¨
- æ”¯æŒå¤šæ­¥éª¤æ¨ç†
- é€‚åˆå¤æ‚ä»»åŠ¡æ‰§è¡Œ

**æ ‡ç­¾**: `agent`, `llm`, `planning`, `tool`, `mcp`, `æ™ºèƒ½ä½“`, `å·¥å…·è°ƒç”¨`, `è§„åˆ’`, `è‡ªä¸»`, `ä»»åŠ¡æ‰§è¡Œ`

**ç¤ºä¾‹è·¯å¾„**: `examples/agents/agent.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `iter_queries` - ä»»åŠ¡æŸ¥è¯¢è¿­ä»£å™¨
- Stage 1: `LLMPlanner` - LLM è§„åˆ’å™¨ï¼ˆAgent ç±»å‹ï¼‰
- Stage 2: `MCPRegistry` - MCP å·¥å…·æ³¨å†Œè¡¨ï¼ˆTool ç±»å‹ï¼‰
- Stage 3: `AgentRuntime` - æ™ºèƒ½ä½“è¿è¡Œæ—¶ï¼ˆAgent ç±»å‹ï¼‰
- Sink: `TerminalSink`
- Service: MCP å·¥å…·æœåŠ¡

**é€‚ç”¨åœºæ™¯**: 
- æ•°æ®åˆ†æ
- ä»£ç ç”Ÿæˆ
- ä¿¡æ¯æ”¶é›†
- è‡ªåŠ¨åŒ–æ“ä½œ

---

### 5. **è®°å¿†å¢å¼ºå¯¹è¯é—®ç­”** (`rag-memory-enhanced`)

**åœºæ™¯**: æ”¯æŒå¤šè½®å¯¹è¯çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥é—®ç­”ç³»ç»Ÿ

**ç‰¹ç‚¹**:
- è‡ªåŠ¨å­˜å‚¨å†å²å¯¹è¯åˆ°è®°å¿†æœåŠ¡
- æ£€ç´¢æ—¶è€ƒè™‘å†å²ä¸Šä¸‹æ–‡
- ä¿æŒå¯¹è¯è¿è´¯æ€§
- ä½¿ç”¨æœåŠ¡æ¶æ„ç®¡ç†ä¼šè¯çŠ¶æ€

**æ ‡ç­¾**: `rag`, `memory`, `conversation`, `multi-turn`, `dialogue`, `è®°å¿†`, `å¯¹è¯`, `ä¸Šä¸‹æ–‡`, `å¤šè½®`, `ä¼šè¯`

**ç¤ºä¾‹è·¯å¾„**: `examples/memory/rag_memory_pipeline.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `QuestionSource` - é—®é¢˜æ‰¹å¤„ç†æº
- Stage 1: `Retriever` - è®°å¿†æ„ŸçŸ¥æ£€ç´¢å™¨
- Stage 2: `QAPromptor`
- Stage 3: `OpenAIGenerator`
- Stage 4: `Writer` - è®°å¿†å†™å…¥å™¨
- Sink: `PrintSink`
- Service: `RAGMemoryService` - è®°å¿†æœåŠ¡ï¼ˆChromaDB åç«¯ï¼‰

**é€‚ç”¨åœºæ™¯**:
- å®¢æœæœºå™¨äºº
- ä¸ªäººåŠ©æ‰‹
- é•¿å¯¹è¯ç³»ç»Ÿ

---

### 6. **è·¨æ¨¡æ€æœç´¢å¼•æ“** (`multimodal-cross-search`)

**åœºæ™¯**: æ”¯æŒæ–‡æœ¬ã€å›¾åƒåŠèåˆæ£€ç´¢çš„å¤šæ¨¡æ€æœç´¢

**ç‰¹ç‚¹**:
- æ”¯æŒä¸‰ç§æ£€ç´¢æ¨¡å¼ï¼šæ–‡æœ¬ã€å›¾åƒã€èåˆ
- å¯é…ç½®èåˆç­–ç•¥ï¼ˆåŠ æƒå¹³å‡ã€RRF ç­‰ï¼‰
- åŸºäº SageDB æˆ–å¤šæ¨¡æ€å‘é‡åº“
- çµæ´»çš„æ¨¡æ€æƒé‡é…ç½®

**æ ‡ç­¾**: `multimodal`, `cross-modal`, `search`, `fusion`, `image`, `text`, `è·¨æ¨¡æ€`, `æœç´¢`, `å›¾æ–‡`, `æ£€ç´¢`

**ç¤ºä¾‹è·¯å¾„**: `examples/multimodal/cross_modal_search.py`

**æ ¸å¿ƒç»„ä»¶**:
- Source: `JSONLBatch` - å¤šæ¨¡æ€æŸ¥è¯¢æ•°æ®æº
- Stage 1: `create_text_image_db` - è·¨æ¨¡æ€æ£€ç´¢å™¨
- Stage 2: `MultimodalReranker` - å¤šæ¨¡æ€é‡æ’åº
- Sink: `TerminalSink` (JSON æ ¼å¼)

**é€‚ç”¨åœºæ™¯**:
- ç”µå•†æœç´¢
- æ–°é—»æ£€ç´¢
- ç¤¾äº¤åª’ä½“

---

## ğŸ“Š æ¨¡æ¿åŒ¹é…æµ‹è¯•ç»“æœ

æ‰€æœ‰ 6 ä¸ªæ–°æ¨¡æ¿å‡é€šè¿‡äº†åŒ¹é…æµ‹è¯•ï¼š

| æµ‹è¯•åœºæ™¯ | é¢„æœŸæ¨¡æ¿ | å®é™…åŒ¹é… | åŒ¹é…åº¦ | ç»“æœ |
|---------|---------|---------|--------|------|
| Milvus å‘é‡æ£€ç´¢ | `rag-dense-milvus` | `rag-dense-milvus` | 0.305 | âœ… |
| é‡æ’åºæ£€ç´¢ | `rag-rerank` | `rag-rerank` | 0.200 | âœ… |
| BM25 å…³é”®è¯æ£€ç´¢ | `rag-bm25-sparse` | `rag-bm25-sparse` | 0.222 | âœ… |
| æ™ºèƒ½ä½“ç³»ç»Ÿ | `agent-workflow` | `agent-workflow` | 0.300 | âœ… |
| è®°å¿†å¯¹è¯ | `rag-memory-enhanced` | `rag-memory-enhanced` | 0.300 | âœ… |
| è·¨æ¨¡æ€æœç´¢ | `multimodal-cross-search` | `multimodal-cross-search` | 0.340 | âœ… |

**æµ‹è¯•é€šè¿‡ç‡**: 6/6 (100%)

---

## ğŸ—ï¸ æŠ€æœ¯å®ç°

### æ–‡ä»¶ä¿®æ”¹

1. **`packages/sage-tools/src/sage/tools/cli/pipeline_blueprints.py`**
   - æ–°å¢ 6 ä¸ª `PipelineBlueprint` å®šä¹‰
   - æ¯ä¸ªè“å›¾åŒ…å«å®Œæ•´çš„ Sourceã€Stagesã€Sink è§„æ ¼
   - å®šä¹‰äº†ç›¸å…³çš„ graph_channels å’Œ graph_agents

2. **`packages/sage-tools/src/sage/tools/templates/catalog.py`**
   - æ–°å¢ 6 ä¸ª `ApplicationTemplate` å®šä¹‰
   - ä¸ºæ¯ä¸ªæ¨¡æ¿æä¾›è¯¦ç»†çš„æè¿°ã€æ ‡ç­¾ã€æŒ‡å¯¼å’Œæ³¨æ„äº‹é¡¹
   - å…³è”å¯¹åº”çš„è“å›¾ ID

### è“å›¾ä¸æ¨¡æ¿å¯¹åº”å…³ç³»

| è“å›¾ ID | æ¨¡æ¿ ID | ç¤ºä¾‹è·¯å¾„ |
|---------|---------|----------|
| `rag-dense-milvus` | `rag-dense-milvus` | `examples/rag/qa_dense_retrieval_milvus.py` |
| `rag-rerank` | `rag-rerank` | `examples/rag/qa_rerank.py` |
| `rag-bm25-sparse` | `rag-bm25-sparse` | `examples/rag/qa_bm25_retrieval.py` |
| `agent-workflow` | `agent-workflow` | `examples/agents/agent.py` |
| `rag-memory-enhanced` | `rag-memory-enhanced` | `examples/memory/rag_memory_pipeline.py` |
| `multimodal-cross-search` | `multimodal-cross-search` | `examples/multimodal/cross_modal_search.py` |

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯è¦†ç›–

æ–°å¢çš„æ¨¡æ¿è¦†ç›–äº†ä»¥ä¸‹åº”ç”¨åœºæ™¯ï¼š

### RAG å¢å¼ºåœºæ™¯
- âœ… **å¯†é›†å‘é‡æ£€ç´¢** - å¤§è§„æ¨¡è¯­ä¹‰æœç´¢ï¼ˆMilvusï¼‰
- âœ… **é‡æ’åºä¼˜åŒ–** - é«˜ç²¾åº¦ä¸¤é˜¶æ®µæ£€ç´¢
- âœ… **ç¨€ç–æ£€ç´¢** - BM25 å…³é”®è¯åŒ¹é…
- âœ… **è®°å¿†å¢å¼º** - å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡

### é«˜çº§åº”ç”¨åœºæ™¯
- âœ… **æ™ºèƒ½ä½“ç³»ç»Ÿ** - LLM è§„åˆ’ + å·¥å…·è°ƒç”¨
- âœ… **å¤šæ¨¡æ€æ£€ç´¢** - è·¨æ–‡æœ¬å’Œå›¾åƒçš„èåˆæœç´¢

### ç”Ÿäº§ç¯å¢ƒæ”¯æŒ
- âœ… **å‘é‡æ•°æ®åº“** - Milvus ç”Ÿäº§çº§éƒ¨ç½²
- âœ… **ç²¾ç¡®åº¦ä¼˜åŒ–** - Reranker äºŒæ¬¡æ’åº
- âœ… **èµ„æºä¼˜åŒ–** - BM25 ä½æˆæœ¬æ£€ç´¢
- âœ… **çŠ¶æ€ç®¡ç†** - è®°å¿†æœåŠ¡æ¶æ„

---

## ğŸ“ˆ æ”¹è¿›æ•ˆæœ

### æ¨¡æ¿åº“æ‰©å……
- **åŸæœ‰æ¨¡æ¿**: 4 ä¸ª
- **æ–°å¢æ¨¡æ¿**: 6 ä¸ª
- **æ€»è®¡**: 10 ä¸ª
- **å¢é•¿**: 150%

### åœºæ™¯è¦†ç›–å¢å¼º
- **RAG åœºæ™¯**: ä» 1 ä¸ªç®€å•ç¤ºä¾‹æ‰©å±•åˆ°è¦†ç›–å¯†é›†ã€ç¨€ç–ã€é‡æ’ã€è®°å¿†ç­‰å¤šç§æ£€ç´¢æ–¹å¼
- **Agent åœºæ™¯**: æ–°å¢å®Œæ•´çš„æ™ºèƒ½ä½“å·¥ä½œæµæ”¯æŒ
- **å¤šæ¨¡æ€åœºæ™¯**: æ‰©å±•åˆ°è·¨æ¨¡æ€æ£€ç´¢å’Œèåˆ

### LLM ç”Ÿæˆèƒ½åŠ›æå‡
é€šè¿‡æ›´ä¸°å¯Œçš„æ¨¡æ¿å’Œæ ‡ç­¾ï¼ŒLLM ç°åœ¨å¯ä»¥ï¼š
- æ›´å‡†ç¡®åœ°ç†è§£ç”¨æˆ·æ„å›¾
- ä¸ºå¤æ‚åœºæ™¯ç”Ÿæˆåˆé€‚çš„ Pipeline é…ç½®
- æä¾›æ›´å…·ä½“çš„å®ç°æŒ‡å¯¼å’Œæ³¨æ„äº‹é¡¹

---

## ğŸ§ª æµ‹è¯•éªŒè¯

åˆ›å»ºäº†ä¸¤ä¸ªæµ‹è¯•è„šæœ¬ï¼š

1. **`examples/tutorials/test_template_matching.py`**
   - éªŒè¯æ¨¡æ¿åŒ¹é…çš„å‡†ç¡®æ€§
   - æµ‹è¯• 6 ç§å…¸å‹åœºæ™¯
   - æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨æ¨¡æ¿

2. **`examples/tutorials/test_new_templates.py`**
   - ä½¿ç”¨çœŸå® LLM API æµ‹è¯•é…ç½®ç”Ÿæˆ
   - éªŒè¯ç«¯åˆ°ç«¯åŠŸèƒ½

**è¿è¡Œæµ‹è¯•**:
```bash
python examples/tutorials/test_template_matching.py
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¸ºæ–°åº”ç”¨é€‰æ‹©åˆé€‚çš„æ¨¡æ¿

**å‘é‡æ£€ç´¢åœºæ™¯**:
- å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ â†’ `rag-dense-milvus`
- é«˜ç²¾åº¦è¦æ±‚ â†’ `rag-rerank`
- å…³é”®è¯åŒ¹é… â†’ `rag-bm25-sparse`

**å¯¹è¯åœºæ™¯**:
- ç®€å•é—®ç­” â†’ `rag-simple-demo`
- å¤šè½®å¯¹è¯ â†’ `rag-memory-enhanced`

**é«˜çº§åº”ç”¨**:
- è‡ªä¸»ä»»åŠ¡æ‰§è¡Œ â†’ `agent-workflow`
- å›¾æ–‡æ··åˆæ£€ç´¢ â†’ `multimodal-cross-search`

### 2. æ ‡ç­¾ä½¿ç”¨æŒ‡å—

ä¸ºè·å¾—æ›´å¥½çš„åŒ¹é…æ•ˆæœï¼Œç”¨æˆ·éœ€æ±‚ä¸­åº”åŒ…å«ï¼š
- **æ˜ç¡®çš„å…³é”®è¯**: "Milvus"ã€"é‡æ’åº"ã€"æ™ºèƒ½ä½“" ç­‰
- **åœºæ™¯æè¿°**: "å¤šè½®å¯¹è¯"ã€"è·¨æ¨¡æ€" ç­‰
- **æŠ€æœ¯éœ€æ±‚**: "å‘é‡æ•°æ®åº“"ã€"å·¥å…·è°ƒç”¨" ç­‰

### 3. æ‰©å±•å»ºè®®

æœªæ¥å¯ä»¥ç»§ç»­æ·»åŠ æ¨¡æ¿ï¼š
- æµå¼å¤„ç†åœºæ™¯
- å®æ—¶æ¨ç†åœºæ™¯
- åˆ†å¸ƒå¼éƒ¨ç½²åœºæ™¯
- æ›´å¤šå‚ç›´é¢†åŸŸåœºæ™¯ï¼ˆåŒ»ç–—ã€é‡‘èã€æ³•å¾‹ç­‰ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Pipeline Builder V2 æ”¹è¿›æ–‡æ¡£](./PIPELINE_BUILDER_V2_IMPROVEMENTS.md)
- [LLM äº¤äº’è¯¦ç»†è¯´æ˜](./LLM_INTERACTION_IN_PIPELINE_BUILDER.md)
- [æ¨¡æ¿åœ¨ LLM ä¸­çš„ä½¿ç”¨](./TEMPLATES_IN_LLM_DETAILED.md)

---

## âœ… æ€»ç»“

é€šè¿‡æ–°å¢ 6 ä¸ªé«˜è´¨é‡åº”ç”¨æ¨¡æ¿ï¼ŒSAGE Pipeline Builder ç°åœ¨èƒ½å¤Ÿï¼š

1. âœ… æ”¯æŒæ›´å¤šå¤æ‚çš„ç”Ÿäº§ç¯å¢ƒåœºæ™¯
2. âœ… ä¸º LLM æä¾›æ›´ä¸°å¯Œçš„å‚è€ƒæ ·æœ¬
3. âœ… æé«˜é…ç½®ç”Ÿæˆçš„å‡†ç¡®æ€§å’Œå®ç”¨æ€§
4. âœ… è¦†ç›–ä»ç®€å•åˆ°å¤æ‚ã€ä»å•æ¨¡æ€åˆ°å¤šæ¨¡æ€çš„å¹¿æ³›åº”ç”¨åœºæ™¯

æ‰€æœ‰æ–°æ¨¡æ¿éƒ½ç»è¿‡æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥ç›´æ¥æŠ•å…¥ä½¿ç”¨ï¼ğŸ‰

# sageLLM æ··åˆè°ƒåº¦å™¨ - é¡¹ç›®æ€»ç»“

> **åˆ†æ”¯**: `feature/embedding_lmm_mixed_scheduler`  
> **å¼€å‘å‘¨æœŸ**: 2025å¹´11æœˆ  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡

å°† `IntelligentLLMClient` å’Œ `IntelligentEmbeddingClient` åˆå¹¶ä¸ºç»Ÿä¸€çš„ `UnifiedInferenceClient`ï¼Œé€šè¿‡å¢å¼º sageLLM Control Plane å®ç° LLM å’Œ Embedding è¯·æ±‚åœ¨ç»Ÿä¸€ GPU èµ„æºæ± å†…çš„æ··åˆè°ƒåº¦ï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ã€‚

### 1.2 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | æè¿° |
|--------|------|
| ğŸ”„ **ç»Ÿä¸€å…¥å£** | å•ä¸€å®¢æˆ·ç«¯å¤„ç† LLM (chat/generate) å’Œ Embedding è¯·æ±‚ |
| ğŸ“Š **æ™ºèƒ½è°ƒåº¦** | åŸºäºè¯·æ±‚ç±»å‹ã€è´Ÿè½½çŠ¶æ€å’Œä¼˜å…ˆçº§çš„è‡ªé€‚åº”è°ƒåº¦ç­–ç•¥ |
| ğŸš€ **èµ„æºä¼˜åŒ–** | Embedding æ‰¹å¤„ç†èšåˆï¼Œå‡å°‘ GPU ç¢ç‰‡åŒ– |
| ğŸ”Œ **OpenAI å…¼å®¹** | ç»Ÿä¸€ API Server å®Œå…¨å…¼å®¹ OpenAI API è§„èŒƒ |
| âœ… **å‘åå…¼å®¹** | ç°æœ‰å®¢æˆ·ç«¯ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹ |

---

## 2. æ¶æ„è®¾è®¡

### 2.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åº”ç”¨å±‚ (Application Layer)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      UnifiedInferenceClient                              â”‚
â”‚                 chat() | generate() | embed()                            â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚        â”‚   Simple Mode       â”‚  Control Plane Mode â”‚                    â”‚
â”‚        â”‚  (ç›´è¿åç«¯ API)      â”‚  (é€šè¿‡è°ƒåº¦å™¨è·¯ç”±)    â”‚                    â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                       UnifiedAPIServer                                   â”‚
â”‚              (OpenAI-Compatible REST API Gateway)                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ /v1/chat/      â”‚ /v1/           â”‚ /v1/           â”‚ /v1/models   â”‚   â”‚
â”‚   â”‚ completions    â”‚ completions    â”‚ embeddings     â”‚ /health      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    sageLLM Control Plane (å¢å¼ºç‰ˆ)                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                   RequestClassifier                              â”‚   â”‚
â”‚   â”‚    (è¯·æ±‚åˆ†ç±»: LLM_CHAT / LLM_GENERATE / EMBEDDING)               â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                  HybridSchedulingPolicy                          â”‚   â”‚
â”‚   â”‚  â€¢ è¯·æ±‚ç±»å‹åˆ†ç»„          â€¢ Embedding æ‰¹å¤„ç†èšåˆ                    â”‚   â”‚
â”‚   â”‚  â€¢ ä¼˜å…ˆçº§è°ƒåº¦            â€¢ æ··åˆå®ä¾‹è´Ÿè½½å‡è¡¡                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                        ç»Ÿä¸€èµ„æºæ±  (GPU Pool)                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  vLLM Instance  â”‚  â”‚  vLLM Instance  â”‚  â”‚  TEI Instance   â”‚        â”‚
â”‚   â”‚  (LLM Only)     â”‚  â”‚  (LLM+Embed)    â”‚  â”‚  (Embed Only)   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶ä½ç½® | èŒè´£ |
|------|----------|------|
| `RequestClassifier` | `sageLLM/control_plane/request_classifier.py` | è‡ªåŠ¨è¯†åˆ«è¯·æ±‚ç±»å‹ï¼Œç­›é€‰å…¼å®¹å®ä¾‹ |
| `HybridSchedulingPolicy` | `sageLLM/control_plane/strategies/hybrid_policy.py` | æ··åˆè°ƒåº¦ç­–ç•¥ï¼Œæ‰¹å¤„ç†èšåˆ |
| `UnifiedInferenceClient` | `sage_llm/unified_client.py` | ç»Ÿä¸€å®¢æˆ·ç«¯å…¥å£ |
| `UnifiedAPIServer` | `sage_llm/unified_api_server.py` | OpenAI å…¼å®¹ API æœåŠ¡å™¨ |
| CLI `inference` | `sage-cli/commands/apps/inference.py` | æœåŠ¡ç®¡ç†å‘½ä»¤ |

---

## 3. å¼€å‘é˜¶æ®µ

### Phase 1: åŸºç¡€è®¾æ–½å‡†å¤‡ âœ…

**ç›®æ ‡**: æ‰©å±•ç±»å‹ç³»ç»Ÿï¼Œæ”¯æŒ Embedding è¯·æ±‚å’Œæ··åˆå®ä¾‹

| ä»»åŠ¡ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|--------|------|
| T1.1 æ‰©å±•è¯·æ±‚ç±»å‹ | `RequestType` æšä¸¾, `RequestMetadata` æ‰©å±• | âœ… |
| T1.2 æ‰©å±•å®ä¾‹ç±»å‹ | `ExecutionInstanceType` æ‰©å±•, èƒ½åŠ›åˆ¤æ–­æ–¹æ³• | âœ… |
| T1.3 Embedding æ‰§è¡Œå™¨ | `EmbeddingExecutor` (é›†æˆåˆ° hybrid_policy) | âœ… |

**å…³é”®ä»£ç **:
```python
class RequestType(Enum):
    LLM_CHAT = "llm_chat"
    LLM_GENERATE = "llm_generate"
    EMBEDDING = "embedding"

class ExecutionInstanceType(Enum):
    # ... ç°æœ‰ç±»å‹ ...
    EMBEDDING = "embedding"       # çº¯ Embedding å®ä¾‹
    LLM_EMBEDDING = "llm_embedding" # æ··åˆå®ä¾‹
```

### Phase 2: Control Plane æ··åˆè°ƒåº¦æ ¸å¿ƒ âœ…

**ç›®æ ‡**: å®ç°è¯·æ±‚åˆ†ç±»å’Œæ··åˆè°ƒåº¦ç­–ç•¥

| ä»»åŠ¡ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|--------|------|
| T2.1 è¯·æ±‚åˆ†ç±»å™¨ | `RequestClassifier` (~576 è¡Œ) | âœ… |
| T2.2 æ··åˆè°ƒåº¦ç­–ç•¥ | `HybridSchedulingPolicy` (~885 è¡Œ) | âœ… |
| T2.3 Manager æ‰©å±• | é›†æˆåˆ°è°ƒåº¦æµç¨‹ | âœ… |

**å…³é”®ä»£ç **:
```python
class HybridSchedulingPolicy(SchedulingPolicy):
    def schedule(self, requests, instances) -> list[SchedulingDecision]:
        # 1. æŒ‰ request_type åˆ†ç»„
        # 2. Embedding: æ‰¹é‡èšåˆ â†’ ä¸“ç”¨å®ä¾‹ä¼˜å…ˆ
        # 3. LLM: ä½¿ç”¨é…ç½®çš„å›é€€ç­–ç•¥
        # 4. æ··åˆå®ä¾‹è´Ÿè½½å‡è¡¡
```

### Phase 3: ç»Ÿä¸€å®¢æˆ·ç«¯å®ç° âœ…

**ç›®æ ‡**: åˆ›å»ºç»Ÿä¸€å®¢æˆ·ç«¯ï¼Œåˆå¹¶ LLM å’Œ Embedding æ¥å£

| ä»»åŠ¡ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|--------|------|
| T3.1 ç»Ÿä¸€å®¢æˆ·ç«¯ | `UnifiedInferenceClient` (~1062 è¡Œ) | âœ… |
| T3.2 å‘åå…¼å®¹ | ç°æœ‰å®¢æˆ·ç«¯ä¿æŒä¸å˜ | âœ… |

**å…³é”®ä»£ç **:
```python
class UnifiedInferenceClient:
    @classmethod
    def create_auto(cls) -> UnifiedInferenceClient:
        """è‡ªåŠ¨æ£€æµ‹: ç¯å¢ƒå˜é‡ â†’ æœ¬åœ°æœåŠ¡ â†’ äº‘ç«¯ API"""

    def chat(self, messages, **kwargs) -> str: ...
    def generate(self, prompt, **kwargs) -> str: ...
    def embed(self, texts, **kwargs) -> list[list[float]]: ...
```

### Phase 4: æœåŠ¡ç«¯ç»Ÿä¸€ âœ…

**ç›®æ ‡**: åˆ›å»ºç»Ÿä¸€ API æœåŠ¡å™¨ï¼Œé›†æˆ CLI

| ä»»åŠ¡ | äº¤ä»˜ç‰© | çŠ¶æ€ |
|------|--------|------|
| T4.1 ç»Ÿä¸€ API Server | `UnifiedAPIServer` (~956 è¡Œ) | âœ… |
| T4.2 CLI é›†æˆ | `sage inference start/stop/status` (~650 è¡Œ) | âœ… |

**API ç«¯ç‚¹**:
- `POST /v1/chat/completions` - èŠå¤©è¡¥å…¨
- `POST /v1/completions` - æ–‡æœ¬è¡¥å…¨
- `POST /v1/embeddings` - å‘é‡åµŒå…¥
- `GET /v1/models` - æ¨¡å‹åˆ—è¡¨
- `GET /health` - å¥åº·æ£€æŸ¥

### Phase 5: æµ‹è¯• âœ…

**ç›®æ ‡**: å®Œå–„æµ‹è¯•è¦†ç›–

| ä»»åŠ¡ | äº¤ä»˜ç‰© | æµ‹è¯•æ•° | çŠ¶æ€ |
|------|--------|--------|------|
| T5.1 å•å…ƒæµ‹è¯• | å®¢æˆ·ç«¯ã€å…¼å®¹æ€§æµ‹è¯• | 55 | âœ… |
| T5.2 é›†æˆæµ‹è¯• | è°ƒåº¦ã€æœåŠ¡å™¨ã€ç«¯åˆ°ç«¯æµ‹è¯• | 87 | âœ… |
| CLI æµ‹è¯• | å‘½ä»¤è¡Œæµ‹è¯• | 23 | âœ… |
| **æ€»è®¡** | | **165** | âœ… |

---

## 4. æ–‡ä»¶å˜æ›´

### 4.1 æ–°å¢æ–‡ä»¶ (12 ä¸ª)

```
packages/sage-common/src/sage/common/components/sage_llm/
â”œâ”€â”€ unified_client.py                    # ç»Ÿä¸€æ¨ç†å®¢æˆ·ç«¯
â”œâ”€â”€ unified_api_server.py                # OpenAI å…¼å®¹ API æœåŠ¡å™¨
â””â”€â”€ sageLLM/control_plane/
    â”œâ”€â”€ request_classifier.py            # è¯·æ±‚åˆ†ç±»å™¨
    â””â”€â”€ strategies/
        â””â”€â”€ hybrid_policy.py             # æ··åˆè°ƒåº¦ç­–ç•¥

packages/sage-common/tests/
â”œâ”€â”€ unit/components/sage_llm/
â”‚   â”œâ”€â”€ test_unified_client.py           # å®¢æˆ·ç«¯å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ test_compat.py                   # å…¼å®¹æ€§æµ‹è¯•
â””â”€â”€ integration/
    â”œâ”€â”€ conftest.py                      # æµ‹è¯• fixtures
    â”œâ”€â”€ test_hybrid_scheduling_e2e.py    # è°ƒåº¦é›†æˆæµ‹è¯•
    â”œâ”€â”€ test_unified_api_server.py       # æœåŠ¡å™¨é›†æˆæµ‹è¯•
    â””â”€â”€ test_unified_client_e2e.py       # å®¢æˆ·ç«¯é›†æˆæµ‹è¯•

packages/sage-cli/
â”œâ”€â”€ src/sage/cli/commands/apps/inference.py  # CLI å‘½ä»¤
â””â”€â”€ tests/test_inference_cli.py              # CLI æµ‹è¯•
```

### 4.2 ä¿®æ”¹æ–‡ä»¶ (8 ä¸ª)

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `sageLLM/control_plane/types.py` | æ–°å¢ RequestType, æ‰©å±• RequestMetadata/ExecutionInstance |
| `sageLLM/control_plane/strategies/__init__.py` | å¯¼å‡º HybridSchedulingPolicy |
| `sageLLM/control_plane/__init__.py` | å¯¼å‡ºæ–°å¢ç±»å‹ |
| `sage_llm/__init__.py` | å¯¼å‡º UnifiedInferenceClient, UnifiedAPIServer |
| `sage_llm/client.py` | å‘åå…¼å®¹å±‚ |
| `sage_embedding/client.py` | å‘åå…¼å®¹å±‚ |
| `sage-cli/commands/apps/__init__.py` | æ³¨å†Œ inference å‘½ä»¤ |
| `sage-cli/main.py` | æ·»åŠ  inference å­å‘½ä»¤ |

---

## 5. ä½¿ç”¨æŒ‡å—

### 5.1 ç»Ÿä¸€å®¢æˆ·ç«¯

```python
from sage.common.components.sage_llm import UnifiedInferenceClient

# è‡ªåŠ¨æ£€æµ‹æ¨¡å¼
client = UnifiedInferenceClient.create_auto()

# èŠå¤©
response = client.chat([{"role": "user", "content": "Hello"}])

# ç”Ÿæˆ
text = client.generate("Once upon a time")

# åµŒå…¥
vectors = client.embed(["text1", "text2"])
```

### 5.2 Control Plane æ¨¡å¼

```python
client = UnifiedInferenceClient.create_with_control_plane(
    instances=[
        {"host": "localhost", "port": 8001, "model_name": "Qwen/...", "instance_type": "llm"},
        {"host": "localhost", "port": 8090, "model_name": "BAAI/bge-m3", "instance_type": "embedding"},
    ],
    scheduling_policy="hybrid",
)
```

### 5.3 CLI å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
sage inference start --port 8000 --background

# æŸ¥çœ‹çŠ¶æ€
sage inference status

# åœæ­¢æœåŠ¡
sage inference stop
```

### 5.4 ç¯å¢ƒå˜é‡

| å˜é‡å | ç”¨é€” |
|--------|------|
| `SAGE_UNIFIED_BASE_URL` | ç»Ÿä¸€æœåŠ¡ç«¯ç‚¹ |
| `SAGE_CHAT_BASE_URL` | LLM æœåŠ¡ç«¯ç‚¹ |
| `SAGE_EMBEDDING_BASE_URL` | Embedding æœåŠ¡ç«¯ç‚¹ |
| `SAGE_CHAT_MODEL` | é»˜è®¤ LLM æ¨¡å‹ |
| `SAGE_EMBEDDING_MODEL` | é»˜è®¤ Embedding æ¨¡å‹ |

---

## 6. æµ‹è¯•

### 6.1 è¿è¡Œæµ‹è¯•

```bash
cd /home/yjy/SAGE

# å•å…ƒæµ‹è¯•
conda run -n sage python -m pytest packages/sage-common/tests/unit/components/sage_llm/ -v

# é›†æˆæµ‹è¯•
conda run -n sage python -m pytest packages/sage-common/tests/integration/ -v

# CLI æµ‹è¯•
conda run -n sage python -m pytest packages/sage-cli/tests/test_inference_cli.py -v

# å…¨é‡æµ‹è¯•
conda run -n sage python -m pytest \
    packages/sage-common/tests/unit/components/sage_llm/ \
    packages/sage-common/tests/integration/ \
    packages/sage-cli/tests/test_inference_cli.py \
    -v
```

### 6.2 æµ‹è¯•è¦†ç›–

| ç±»åˆ« | æµ‹è¯•æ•° |
|------|--------|
| å•å…ƒæµ‹è¯• - å®¢æˆ·ç«¯ | 38 |
| å•å…ƒæµ‹è¯• - å…¼å®¹æ€§ | 17 |
| é›†æˆæµ‹è¯• - è°ƒåº¦ | 22 |
| é›†æˆæµ‹è¯• - æœåŠ¡å™¨ | 33 |
| é›†æˆæµ‹è¯• - å®¢æˆ·ç«¯ | 32 |
| CLI æµ‹è¯• | 23 |
| **æ€»è®¡** | **165** |

---

## 7. é…ç½®å‚è€ƒ

### 7.1 è°ƒåº¦ç­–ç•¥é…ç½®

```python
HybridSchedulingConfig(
    embedding_batch_size=32,           # Embedding æ‰¹å¤„ç†å¤§å°
    embedding_priority="normal",        # high/normal/low/adaptive
    llm_fallback_policy="adaptive",    # fifo/priority/slo_aware/adaptive
    hybrid_instance_ratio=0.7,         # æ··åˆå®ä¾‹ LLM:Embedding æ¯”ä¾‹
    prefer_specialized_instances=True, # ä¼˜å…ˆä½¿ç”¨ä¸“ç”¨å®ä¾‹
)
```

---

## 8. å®¢æˆ·ç«¯é€‰æ‹©æŒ‡å—

### 8.1 ä¸‰ç§å®¢æˆ·ç«¯å¹¶å­˜

æœ¬é¡¹ç›®**æ–°å¢** `UnifiedInferenceClient`ï¼Œä½†**ä¿ç•™**åŸæœ‰çš„ `IntelligentLLMClient` å’Œ `IntelligentEmbeddingClient`ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·å¯é€‰çš„å®¢æˆ·ç«¯                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ UnifiedInferenceClient â”‚    â”‚ IntelligentLLMClient (ä¿ç•™)         â”‚  â”‚
â”‚  â”‚ (æ–°å¢ - æ¨è)          â”‚    â”‚ IntelligentEmbeddingClient (ä¿ç•™)   â”‚  â”‚
â”‚  â”‚                       â”‚    â”‚                                     â”‚  â”‚
â”‚  â”‚ â€¢ chat()              â”‚    â”‚ â€¢ ç‹¬ç«‹ä½¿ç”¨åœºæ™¯                       â”‚  â”‚
â”‚  â”‚ â€¢ generate()          â”‚    â”‚ â€¢ ç°æœ‰ä»£ç æ— éœ€ä»»ä½•ä¿®æ”¹               â”‚  â”‚
â”‚  â”‚ â€¢ embed()             â”‚    â”‚ â€¢ ç®€å•åœºæ™¯æ›´ç®€æ´                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                               â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚              sageLLM Control Plane (å…±äº«è°ƒåº¦)                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”‚                    ç»Ÿä¸€èµ„æºæ±  (GPU Instances)                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 å¦‚ä½•é€‰æ‹©ï¼Ÿ

| åœºæ™¯ | æ¨èå®¢æˆ·ç«¯ | ç†ç”± |
|------|-----------|------|
| æ–°é¡¹ç›®ï¼ŒåŒæ—¶éœ€è¦ LLM å’Œ Embedding | `UnifiedInferenceClient` | ç»Ÿä¸€å…¥å£ï¼Œäº«å—æ··åˆè°ƒåº¦ |
| ç°æœ‰é¡¹ç›®ï¼Œåªä½¿ç”¨ LLM | `IntelligentLLMClient` | æ— éœ€ä¿®æ”¹ï¼Œå‘åå…¼å®¹ |
| ç°æœ‰é¡¹ç›®ï¼Œåªä½¿ç”¨ Embedding | `IntelligentEmbeddingClient` | æ— éœ€ä¿®æ”¹ï¼Œå‘åå…¼å®¹ |
| ç®€å•è„šæœ¬ï¼Œåªéœ€è¦å•ä¸€åŠŸèƒ½ | ç‹¬ç«‹å®¢æˆ·ç«¯ | ä»£ç æ›´ç®€æ´ |
| éœ€è¦é«˜çº§è°ƒåº¦ï¼ˆControl Planeï¼‰ | `UnifiedInferenceClient` | æ”¯æŒ Control Plane æ¨¡å¼ |

### 8.3 ä»£ç ç¤ºä¾‹

```python
# æ–¹å¼ 1: æ–°ä»£ç  - ä½¿ç”¨ UnifiedInferenceClient (æ¨è)
from sage.common.components.sage_llm import UnifiedInferenceClient
client = UnifiedInferenceClient.create_auto()
response = client.chat([{"role": "user", "content": "Hello"}])
vectors = client.embed(["text1", "text2"])

# æ–¹å¼ 2: ç°æœ‰ä»£ç  - ç»§ç»­ä½¿ç”¨ç‹¬ç«‹å®¢æˆ·ç«¯ (ä»ç„¶æœ‰æ•ˆ)
from sage.common.components.sage_llm import IntelligentLLMClient
from sage.common.components.sage_embedding import IntelligentEmbeddingClient
llm = IntelligentLLMClient.create_auto()
embedder = IntelligentEmbeddingClient.create_auto()
```

> **é‡è¦**: ä¸‰ç§å®¢æˆ·ç«¯**éƒ½è¿æ¥åˆ°åŒä¸€ä¸ª sageLLM èµ„æºæ± **ï¼Œäº«å—æ··åˆè°ƒåº¦çš„å¥½å¤„ã€‚é€‰æ‹©å“ªç§å®¢æˆ·ç«¯å–å†³äºä½ çš„ä½¿ç”¨åœºæ™¯å’Œä»£ç é£æ ¼åå¥½ã€‚

### 8.4 ä¸ºä»€ä¹ˆä¿ç•™åŸæœ‰å®¢æˆ·ç«¯ï¼Ÿ

| åŸå›  | è¯´æ˜ |
|------|------|
| **å‘åå…¼å®¹** | ç°æœ‰ä½¿ç”¨ `IntelligentLLMClient` / `IntelligentEmbeddingClient` çš„ä»£ç **æ— éœ€ä»»ä½•ä¿®æ”¹** |
| **ç®€å•åœºæ™¯** | åªéœ€è¦ LLM æˆ–åªéœ€è¦ Embedding çš„åœºæ™¯ï¼Œç”¨åŸæœ‰å®¢æˆ·ç«¯æ›´ç®€æ´ |
| **æ¸è¿›è¿ç§»** | å›¢é˜Ÿå¯ä»¥é€æ­¥è¿ç§»åˆ° `UnifiedInferenceClient`ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰ä»£ç  |

---

## 9. ç›¸å…³æ–‡æ¡£

- [PULL_REQUEST.md](./PULL_REQUEST.md) - PR è¯¦ç»†è¯´æ˜
- [SAGE æ¶æ„æ–‡æ¡£](../../../docs-public/docs_src/dev-notes/package-architecture.md)
- [copilot-instructions.md](../../../../.github/copilot-instructions.md) - LLM & Embedding ä½¿ç”¨æŒ‡å—

---

*æ–‡æ¡£æœ€åæ›´æ–°: 2025å¹´11æœˆ27æ—¥*

# SAGE å·¥ä½œç›®å½•è¯´æ˜

æ­¤ç›®å½• (`.sage/`) æ˜¯ SAGE é¡¹ç›®çš„ç»Ÿä¸€å·¥ä½œç›®å½•ï¼Œç”¨äºå­˜æ”¾**è¿è¡Œæ—¶æ•°æ®**å’Œ**æ„å»ºäº§ç‰©**ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
.sage/
â”œâ”€â”€ build/              # æ„å»ºäº§ç‰©ï¼ˆC++ æ‰©å±•ç¼–è¯‘è¾“å‡ºï¼‰
â”‚   â”œâ”€â”€ middleware/     # sage-middleware ä¸»åŒ…æ„å»º
â”‚   â”œâ”€â”€ sage_db/        # sage_db C++ æ‰©å±•
â”‚   â”œâ”€â”€ sage_flow/      # sage_flow C++ æ‰©å±•
â”‚   â””â”€â”€ sage_tsdb/      # sage_tsdb C++ æ‰©å±•
â”œâ”€â”€ cache/              # ç»Ÿä¸€ç¼“å­˜ç›®å½• ğŸ†•
â”‚   â”œâ”€â”€ ruff/           # Ruff ä»£ç æ£€æŸ¥ç¼“å­˜
â”‚   â”œâ”€â”€ mypy/           # Mypy ç±»å‹æ£€æŸ¥ç¼“å­˜
â”‚   â”œâ”€â”€ pytest/         # Pytest æµ‹è¯•ç¼“å­˜
â”‚   â””â”€â”€ chat/           # å…¶ä»–ç¼“å­˜æ•°æ®
â”œâ”€â”€ checkpoints/        # æ¨¡å‹æ£€æŸ¥ç‚¹
â”œâ”€â”€ coverage/           # ä»£ç è¦†ç›–ç‡æŠ¥å‘Š
â”œâ”€â”€ experiments/        # å®éªŒæ•°æ®
â”œâ”€â”€ logs/               # è¿è¡Œæ—¥å¿—
â”œâ”€â”€ output/             # è¾“å‡ºç»“æœ
â”œâ”€â”€ reports/            # æµ‹è¯•å’Œåˆ†ææŠ¥å‘Š
â”œâ”€â”€ states/             # çŠ¶æ€æ–‡ä»¶
â”œâ”€â”€ studio/             # SAGE Studio ç›¸å…³
â””â”€â”€ temp/               # ä¸´æ—¶æ–‡ä»¶
```

## ğŸ”¨ æ„å»ºç›®å½•è¯´æ˜

### `build/` - C++ æ‰©å±•æ„å»ºäº§ç‰©

æ‰€æœ‰ C++ æ‰©å±•çš„ç¼–è¯‘äº§ç‰©ç»Ÿä¸€å­˜æ”¾åœ¨æ­¤ç›®å½•ï¼ŒåŒ…æ‹¬ï¼š

- **ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶** (.so, .a)
- **CMake ç”Ÿæˆæ–‡ä»¶** (CMakeCache.txt, Makefile, etc.)
- **ä¸­é—´å¯¹è±¡æ–‡ä»¶** (.o)
- **ä¾èµ–åº“** (ç¬¬ä¸‰æ–¹åº“ç¼–è¯‘äº§ç‰©)

#### ä¸ºä»€ä¹ˆä½¿ç”¨ç»Ÿä¸€æ„å»ºç›®å½•ï¼Ÿ

1. âœ… **æ¸…æ™°åˆ†ç¦»**ï¼šæºç å’Œæ„å»ºäº§ç‰©å®Œå…¨åˆ†ç¦»
1. âœ… **æ˜“äºæ¸…ç†**ï¼šä¸€æ¡å‘½ä»¤æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©
1. âœ… **é¿å…æ±¡æŸ“**ï¼šä¸ä¼šåœ¨æºç ç›®å½•äº§ç”Ÿå¤§é‡ç¼–è¯‘æ–‡ä»¶
1. âœ… **ç¬¦åˆæœ€ä½³å®è·µ**ï¼šå‚è€ƒ Rust (target/), CMake (out-of-source build)
1. âœ… **Git å‹å¥½**ï¼šæ•´ä¸ª `.sage/` ç›®å½•å·²è¢« gitignore

### æ¸…ç†æ„å»ºäº§ç‰©

```bash
# æ¸…ç†æ‰€æœ‰æ„å»ºäº§ç‰©ï¼ˆæ¨èï¼‰
make clean

# æˆ–æ‰‹åŠ¨æ¸…ç†
rm -rf .sage/build/

# æ¸…ç†ç‰¹å®šæ¨¡å—
rm -rf .sage/build/sage_flow/
rm -rf .sage/build/sage_db/
rm -rf .sage/build/sage_tsdb/
rm -rf .sage/build/middleware/
```

### å·²åºŸå¼ƒçš„æ„å»ºä½ç½®

ä»¥ä¸‹ä½ç½®**ä¸åº”è¯¥**å†äº§ç”Ÿæ„å»ºæ–‡ä»¶ï¼ˆå¦‚æœå‘ç°è¯·æŠ¥å‘Š bugï¼‰ï¼š

- âŒ `build/` - æ—§çš„æ ¹ç›®å½•æ„å»º
- âŒ `packages/sage-middleware/build/` - æ—§çš„åŒ…æ„å»º
- âŒ `packages/sage-middleware/lib/` - æ—§çš„åº“è¾“å‡º
- âŒ `packages/sage-middleware/bin/` - æ—§çš„äºŒè¿›åˆ¶è¾“å‡º
- âŒ `packages/sage-middleware/sage_*_build/` - æ—§çš„å­æ¨¡å—æ„å»º
- âŒ `.../components/*/build/` - å­æ¨¡å—å†…çš„æœ¬åœ°æ„å»º
- âŒ `.../components/*/lib/` - å­æ¨¡å—å†…çš„åº“è¾“å‡º
- âŒ `.../components/*/install/` - å­æ¨¡å—å†…çš„å®‰è£…ç›®å½•

è¿™äº›ä½ç½®å·²åœ¨ `.gitignore` ä¸­æ ‡è®°ï¼Œå¹¶ä¼šè¢« `make clean` æ¸…ç†ã€‚

## ğŸ“Š è¿è¡Œæ—¶æ•°æ®ç›®å½•

### `logs/` - æ—¥å¿—æ–‡ä»¶

- åº”ç”¨è¿è¡Œæ—¥å¿—
- æµ‹è¯•æ—¥å¿—
- å®‰è£…æ—¥å¿—

### `cache/` - ç¼“å­˜æ•°æ®

**ç»Ÿä¸€çš„å¼€å‘å·¥å…·ç¼“å­˜ç›®å½•** - æ‰€æœ‰å¼€å‘å·¥å…·çš„ç¼“å­˜ç»Ÿä¸€å­˜æ”¾åœ¨æ­¤

- **ruff/** - Ruff ä»£ç æ£€æŸ¥å·¥å…·ç¼“å­˜ï¼ˆé€šè¿‡ `RUFF_CACHE_DIR` ç¯å¢ƒå˜é‡é…ç½®ï¼‰
- **mypy/** - Mypy ç±»å‹æ£€æŸ¥å·¥å…·ç¼“å­˜ï¼ˆé€šè¿‡ `MYPY_CACHE_DIR` ç¯å¢ƒå˜é‡é…ç½®ï¼‰
- **pytest/** - Pytest æµ‹è¯•æ¡†æ¶ç¼“å­˜ï¼ˆåœ¨ `tools/pytest.ini` ä¸­é…ç½®ï¼‰
- **chat/** - å…¶ä»–è¿è¡Œæ—¶ç¼“å­˜

**é…ç½®æ–¹æ³•**ï¼š

```bash
# åœ¨ .env æ–‡ä»¶ä¸­å·²é¢„é…ç½®ï¼ˆä» .env.template å¤åˆ¶ï¼‰
RUFF_CACHE_DIR=.sage/cache/ruff
MYPY_CACHE_DIR=.sage/cache/mypy
# pytest ç¼“å­˜åœ¨ tools/pytest.ini ä¸­é…ç½®
```

è¿™é¿å…äº†åœ¨å„ä¸ªåŒ…ç›®å½•ä¸‹åˆ›å»ºåˆ†æ•£çš„ `.ruff_cache/`, `.mypy_cache/`, `.pytest_cache/` ç›®å½•ã€‚

### `checkpoints/` - æ£€æŸ¥ç‚¹

- è®­ç»ƒæ£€æŸ¥ç‚¹
- çŠ¶æ€ä¿å­˜ç‚¹

### `output/` - è¾“å‡ºç»“æœ

- å®éªŒç»“æœ
- ç”Ÿæˆçš„æ–‡ä»¶
- åˆ†æè¾“å‡º

### `reports/` - æŠ¥å‘Š

- æµ‹è¯•æŠ¥å‘Š
- æ€§èƒ½åˆ†æ
- ä»£ç è¦†ç›–ç‡

## ğŸš€ å¼€å‘è€…æç¤º

### é¦–æ¬¡æ„å»º

```bash
# ä½¿ç”¨å¿«é€Ÿå®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰
./quickstart.sh --dev --yes

# æˆ–æ‰‹åŠ¨å®‰è£…
pip install -e packages/sage-middleware
```

### é‡æ–°æ„å»º C++ æ‰©å±•

```bash
# æ¸…ç†åé‡æ–°æ„å»º
make clean
pip install -e packages/sage-middleware --force-reinstall --no-deps

# æˆ–è¿›å…¥å­æ¨¡å—ç›®å½•ç›´æ¥æ„å»º
cd packages/sage-middleware/src/sage/middleware/components/sage_flow/sageFlow
./build.sh
```

### è°ƒè¯•æ„å»ºé—®é¢˜

```bash
# æŸ¥çœ‹æ„å»ºè¾“å‡º
ls -la .sage/build/

# æ£€æŸ¥ CMake é…ç½®
cat .sage/build/sage_flow/CMakeCache.txt

# æŸ¥çœ‹ç¼–è¯‘æ—¥å¿—
tail -f .sage/logs/install.log
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦æ‰‹åŠ¨ä¿®æ”¹** `build/` ç›®å½•ä¸­çš„æ–‡ä»¶
1. **ä¸è¦æäº¤** `.sage/` ç›®å½•åˆ° Gitï¼ˆå·²åœ¨ .gitignore ä¸­ï¼‰
1. **é‡åˆ°æ„å»ºé—®é¢˜**æ—¶ï¼Œå…ˆå°è¯•æ¸…ç†æ„å»ºç›®å½•
1. **ç£ç›˜ç©ºé—´**ï¼šæ„å»ºäº§ç‰©å¯èƒ½å ç”¨è¾ƒå¤§ç©ºé—´ï¼Œå®šæœŸæ¸…ç†

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ„å»ºç³»ç»Ÿæ–‡æ¡£](../docs/dev-notes/build-system.md)
- [å¼€å‘è€…æŒ‡å—](../DEVELOPER.md)
- [è´¡çŒ®æŒ‡å—](../CONTRIBUTING.md)

______________________________________________________________________

**æœ€åæ›´æ–°**: 2025-11-05\
**ç»´æŠ¤è€…**: SAGE Development Team

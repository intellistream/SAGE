# SAGE é—­æºåŒ…å‘å¸ƒè„šæœ¬å¥—ä»¶

## æ¦‚è¿°

è¿™ä¸ªè„šæœ¬å¥—ä»¶åŸºäº sage-dev-toolkit çš„åŠŸèƒ½ï¼Œæä¾›äº†è‡ªåŠ¨åŒ–çš„é—­æºåŒ…ç¼–è¯‘ã€æ‰“åŒ…å’Œå‘å¸ƒæµç¨‹ã€‚å¥—ä»¶åŒ…å«ä¸‰ä¸ªä¸»è¦è„šæœ¬ï¼š

1. **`proprietary_publish.sh`** - ä¸»è¦çš„å‘å¸ƒè„šæœ¬ï¼Œæä¾›å®Œæ•´çš„é—­æºåŒ…å‘å¸ƒåŠŸèƒ½
2. **`quick_publish.sh`** - å¿«æ·åŒ…è£…è„šæœ¬ï¼Œæä¾›é¢„å®šä¹‰çš„å‘å¸ƒæ–¹æ¡ˆ
3. **`proprietary_publish_config.sh`** - é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å¯é…ç½®çš„å‚æ•°

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ”’ **é—­æºç¼–è¯‘**: å°†Pythonæºä»£ç ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œä¿æŠ¤çŸ¥è¯†äº§æƒ
- ğŸ“¦ **è‡ªåŠ¨æ‰“åŒ…**: ä½¿ç”¨æ ‡å‡†çš„Python buildå·¥å…·ç”ŸæˆwheelåŒ…
- ğŸš€ **ä¸€é”®å‘å¸ƒ**: è‡ªåŠ¨ä¸Šä¼ åˆ°PyPIæˆ–Test PyPI
- ğŸ¯ **æ™ºèƒ½ä¾èµ–**: æŒ‰åŒ…ä¾èµ–å…³ç³»é¡ºåºå‘å¸ƒ
- ğŸ§¹ **æ¸…ç†ç®¡ç†**: è‡ªåŠ¨æ¸…ç†æ„å»ºç¼“å­˜å’Œä¸´æ—¶æ–‡ä»¶

### é«˜çº§åŠŸèƒ½
- ğŸ” **é¢„æ¼”æ¨¡å¼**: æ”¯æŒdry-runæ¨¡å¼ï¼Œé¢„è§ˆå‘å¸ƒè¿‡ç¨‹
- ğŸ“Š **è¯¦ç»†æŠ¥å‘Š**: ç”Ÿæˆå‘å¸ƒè¿‡ç¨‹çš„è¯¦ç»†æŠ¥å‘Š
- âš¡ **å¹¶è¡Œå¤„ç†**: æ”¯æŒå¤šåŒ…å¹¶è¡Œç¼–è¯‘å’Œå‘å¸ƒ
- ğŸ›¡ï¸ **å®‰å…¨éªŒè¯**: å‘å¸ƒå‰è¿›è¡Œä»£ç æ£€æŸ¥å’Œæµ‹è¯•
- ğŸ“§ **é€šçŸ¥ç³»ç»Ÿ**: æ”¯æŒé‚®ä»¶ã€Slackã€ä¼ä¸šå¾®ä¿¡é€šçŸ¥
- ğŸ’¾ **å¤‡ä»½ç®¡ç†**: è‡ªåŠ¨å¤‡ä»½æ„å»ºæ–‡ä»¶

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š

```bash
# å®‰è£…sage-dev-toolkit
cd /path/to/SAGE
pip install -e packages/sage-dev-toolkit

# å®‰è£…æ„å»ºå’Œå‘å¸ƒå·¥å…·
pip install build twine

# é…ç½®PyPIå‡­æ®
pip install keyring
```

### 2. ä½¿ç”¨å¿«æ·è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# å¼€å‘æµ‹è¯• - é¢„æ¼”æ¨¡å¼å‘å¸ƒåˆ°Test PyPI
./scripts/quick_publish.sh dev-test

# é¢„å‘å¸ƒ - å‘å¸ƒæ ¸å¿ƒåŒ…åˆ°Test PyPI  
./scripts/quick_publish.sh staging

# ç”Ÿäº§å‘å¸ƒ - å‘å¸ƒæ‰€æœ‰åŒ…åˆ°PyPI
./scripts/quick_publish.sh production

# å•åŒ…å‘å¸ƒ
./scripts/quick_publish.sh single sage-kernel --test-pypi

# äº¤äº’æ¨¡å¼
./scripts/quick_publish.sh custom
```

### 3. ä½¿ç”¨ä¸»è„šæœ¬

```bash
# é¢„æ¼”æ¨¡å¼å‘å¸ƒæ‰€æœ‰åŒ…
./scripts/proprietary_publish.sh --dry-run --all

# å‘å¸ƒæŒ‡å®šåŒ…
./scripts/proprietary_publish.sh --force sage-kernel sage-middleware

# å‘å¸ƒåˆ°æµ‹è¯•PyPI
./scripts/proprietary_publish.sh --test-pypi --output /tmp/builds sage-cli

# æ¸…ç†ç¼“å­˜å¹¶è¯¦ç»†è¾“å‡º
./scripts/proprietary_publish.sh --clean --verbose sage-core
```

## è„šæœ¬è¯¦ç»†è¯´æ˜

### ä¸»è„šæœ¬ `proprietary_publish.sh`

ä¸»è¦çš„å‘å¸ƒè„šæœ¬ï¼Œæä¾›å®Œæ•´çš„å‘½ä»¤è¡Œæ¥å£ã€‚

#### é€‰é¡¹å‚æ•°

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| `-h, --help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |
| `-d, --dry-run` | é¢„æ¼”æ¨¡å¼ï¼Œä¸å®é™…å‘å¸ƒ |
| `-f, --force` | å¼ºåˆ¶å‘å¸ƒï¼Œè·³è¿‡ç¡®è®¤ |
| `-o, --output DIR` | æŒ‡å®šè¾“å‡ºç›®å½• |
| `-t, --test-pypi` | å‘å¸ƒåˆ°æµ‹è¯•PyPI |
| `-a, --all` | å‘å¸ƒæ‰€æœ‰åŒ… |
| `-v, --verbose` | è¯¦ç»†è¾“å‡º |
| `-c, --clean` | æ¸…ç†æ„å»ºç¼“å­˜ |
| `--no-compile` | è·³è¿‡ç¼–è¯‘æ­¥éª¤ |
| `--no-upload` | åªç¼–è¯‘æ‰“åŒ…ï¼Œä¸ä¸Šä¼  |

#### ä½¿ç”¨ç¤ºä¾‹

```bash
# åŸºæœ¬ç”¨æ³•
./scripts/proprietary_publish.sh sage-kernel

# é¢„æ¼”æ¨¡å¼å‘å¸ƒæ‰€æœ‰åŒ…
./scripts/proprietary_publish.sh --dry-run --all

# å¼ºåˆ¶å‘å¸ƒåˆ°æµ‹è¯•PyPI
./scripts/proprietary_publish.sh --force --test-pypi sage-middleware

# è¯¦ç»†è¾“å‡ºå¹¶æ¸…ç†ç¼“å­˜
./scripts/proprietary_publish.sh --verbose --clean --all

# åªç¼–è¯‘ä¸ä¸Šä¼ 
./scripts/proprietary_publish.sh --no-upload --output /tmp/build sage-core
```

### å¿«æ·è„šæœ¬ `quick_publish.sh`

æä¾›é¢„å®šä¹‰çš„å‘å¸ƒæ–¹æ¡ˆï¼Œç®€åŒ–å¸¸ç”¨æ“ä½œã€‚

#### é¢„å®šä¹‰æ–¹æ¡ˆ

| æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|
| `dev-test` | å¼€å‘æµ‹è¯• - é¢„æ¼”æ¨¡å¼å‘å¸ƒæ‰€æœ‰åŒ…åˆ°Test PyPI |
| `staging` | é¢„å‘å¸ƒ - å‘å¸ƒæ ¸å¿ƒåŒ…åˆ°Test PyPI |
| `production` | ç”Ÿäº§å‘å¸ƒ - å‘å¸ƒæ‰€æœ‰åŒ…åˆ°PyPI |
| `core-only` | ä»…æ ¸å¿ƒåŒ… - å‘å¸ƒæ ¸å¿ƒåŒ…åˆ°PyPI |
| `enterprise` | ä¼ä¸šç‰ˆ - å‘å¸ƒä¼ä¸šç‰ˆåŒ… |
| `community` | ç¤¾åŒºç‰ˆ - å‘å¸ƒç¤¾åŒºç‰ˆåŒ… |
| `single <package>` | å•åŒ…å‘å¸ƒ - å‘å¸ƒæŒ‡å®šå•ä¸ªåŒ… |
| `custom` | è‡ªå®šä¹‰ - äº¤äº’æ¨¡å¼ |

#### ä½¿ç”¨ç¤ºä¾‹

```bash
# å¼€å‘æµ‹è¯•
./scripts/quick_publish.sh dev-test

# ç”Ÿäº§å‘å¸ƒ
./scripts/quick_publish.sh production

# ä¼ä¸šç‰ˆå‘å¸ƒ
./scripts/quick_publish.sh enterprise --force

# å•åŒ…å‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒ
./scripts/quick_publish.sh single sage-kernel --test-pypi

# äº¤äº’æ¨¡å¼é€‰æ‹©
./scripts/quick_publish.sh custom
```

### é…ç½®æ–‡ä»¶ `proprietary_publish_config.sh`

åŒ…å«æ‰€æœ‰å¯é…ç½®çš„å‚æ•°å’Œå‡½æ•°åº“ã€‚

#### ä¸»è¦é…ç½®é¡¹

- **åŸºç¡€é…ç½®**: è¾“å‡ºç›®å½•ã€PyPIä»“åº“ç­‰
- **åŒ…é…ç½®**: åŒ…ä¼˜å…ˆçº§ã€ä¾èµ–å…³ç³»ã€åˆ†ç±»ç­‰
- **ç¼–è¯‘é…ç½®**: æ’é™¤æ¨¡å¼ã€ä¿ç•™æºç ç­‰
- **æ„å»ºé…ç½®**: æ„å»ºå·¥å…·é€‰é¡¹ã€å¹¶è¡Œè®¾ç½®ç­‰
- **ä¸Šä¼ é…ç½®**: Twineé€‰é¡¹ã€é‡è¯•æœºåˆ¶ç­‰
- **å®‰å…¨é…ç½®**: ä»£ç æ··æ·†ã€å‹ç¼©è®¾ç½®ç­‰
- **é€šçŸ¥é…ç½®**: é‚®ä»¶ã€Slackã€ä¼ä¸šå¾®ä¿¡ç­‰

#### è‡ªå®šä¹‰é…ç½®

å¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•æˆ–åŒ…ç›®å½•ä¸‹åˆ›å»º `.publish_config` æ–‡ä»¶æ¥è¦†ç›–é»˜è®¤é…ç½®ï¼š

```bash
# åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»ºé…ç½®æ–‡ä»¶
echo 'ENABLE_OBFUSCATION=false' > packages/sage-kernel/.publish_config
echo 'OBFUSCATION_LEVEL=1' >> packages/sage-kernel/.publish_config
```

## åŒ…ä¾èµ–å…³ç³»

è„šæœ¬ä¼šæŒ‰ç…§ä»¥ä¸‹ä¾èµ–å…³ç³»é¡ºåºå‘å¸ƒåŒ…ï¼š

```
sage-kernel (ä¼˜å…ˆçº§1)
â”œâ”€â”€ sage-middleware (ä¼˜å…ˆçº§2) 
â”œâ”€â”€ sage-core (ä¼˜å…ˆçº§3)
â”œâ”€â”€ sage-utils (ä¼˜å…ˆçº§4)
â”‚   â”œâ”€â”€ sage-cli (ä¼˜å…ˆçº§5)
â”‚   â”œâ”€â”€ sage-dev-toolkit (ä¼˜å…ˆçº§6)
â”‚   â””â”€â”€ sage-frontend (ä¼˜å…ˆçº§7)
```

## å‘å¸ƒæµç¨‹

1. **ç¯å¢ƒæ£€æŸ¥**: éªŒè¯Pythonç‰ˆæœ¬ã€ä¾èµ–å·¥å…·ç­‰
2. **åŒ…éªŒè¯**: æ£€æŸ¥åŒ…è·¯å¾„ã€é…ç½®æ–‡ä»¶ç­‰  
3. **ä¾èµ–åˆ†æ**: ç¡®å®šå‘å¸ƒé¡ºåº
4. **ç¡®è®¤å‘å¸ƒ**: æ˜¾ç¤ºå‘å¸ƒè®¡åˆ’ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
5. **æ¸…ç†ç¼“å­˜**: æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
6. **ç¼–è¯‘æºç **: å°†Pythonæºç ç¼–è¯‘ä¸ºå­—èŠ‚ç 
7. **æ„å»ºåŒ…**: ä½¿ç”¨buildå·¥å…·ç”ŸæˆwheelåŒ…
8. **ä¸Šä¼ å‘å¸ƒ**: ä½¿ç”¨twineä¸Šä¼ åˆ°PyPI
9. **ç”ŸæˆæŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„å‘å¸ƒæŠ¥å‘Š
10. **æ¸…ç†ä¸´æ—¶**: æ¸…ç†ä¸´æ—¶æ–‡ä»¶å’Œç›®å½•

## å®‰å…¨ç‰¹æ€§

### æºç ä¿æŠ¤
- å°†æ‰€æœ‰Pythonæºæ–‡ä»¶ç¼–è¯‘ä¸ºå­—èŠ‚ç (.pyc)
- æ”¯æŒå¤šçº§ä»£ç æ··æ·†
- è‡ªåŠ¨åˆ é™¤è°ƒè¯•ä¿¡æ¯å’Œæ³¨é‡Š
- å¯é…ç½®çš„æ–‡ä»¶æ’é™¤è§„åˆ™

### å‘å¸ƒå®‰å…¨
- æ”¯æŒdry-runé¢„æ¼”æ¨¡å¼
- å¼ºåˆ¶ç¡®è®¤æœºåˆ¶
- å¤±è´¥å›æ»šæœºåˆ¶
- æ„å»ºæ–‡ä»¶å¤‡ä»½

## æ—¥å¿—å’ŒæŠ¥å‘Š

### æ—¥å¿—æ–‡ä»¶
é»˜è®¤æ—¥å¿—æ–‡ä»¶ä½ç½®: `~/.sage/dist/publish.log`

### å‘å¸ƒæŠ¥å‘Š
æ¯æ¬¡å‘å¸ƒåä¼šç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼ŒåŒ…å«ï¼š
- å‘å¸ƒæ—¶é—´å’Œæ¨¡å¼
- åŒ…åˆ—è¡¨å’Œç‰ˆæœ¬ä¿¡æ¯
- æ„å»ºæ–‡ä»¶æ¸…å•
- ç¯å¢ƒä¿¡æ¯
- é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–è¯‘å¤±è´¥**
   ```bash
   # æ£€æŸ¥Pythonç‰ˆæœ¬å’Œä¾èµ–
   python3 --version
   pip list | grep sage
   ```

2. **ä¸Šä¼ å¤±è´¥**
   ```bash
   # æ£€æŸ¥PyPIå‡­æ®é…ç½®
   keyring get https://upload.pypi.org/legacy/ __token__
   
   # æ‰‹åŠ¨ä¸Šä¼ æµ‹è¯•
   twine upload --repository testpypi dist/*.whl
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ
   chmod +x scripts/*.sh
   
   # æ£€æŸ¥è¾“å‡ºç›®å½•æƒé™
   ls -la ~/.sage/dist/
   ```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†è¾“å‡ºæ¥è°ƒè¯•é—®é¢˜ï¼š

```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
./scripts/proprietary_publish.sh --verbose --dry-run sage-kernel

# ä¿ç•™æ„å»ºæ–‡ä»¶è¿›è¡Œæ£€æŸ¥
KEEP_BUILD_DIR=true ./scripts/proprietary_publish.sh --dry-run sage-kernel
```

## å¼€å‘å’Œæ‰©å±•

### æ·»åŠ æ–°åŒ…

1. åœ¨ `packages/` ç›®å½•ä¸‹åˆ›å»ºæ–°åŒ…
2. æ›´æ–°é…ç½®æ–‡ä»¶ä¸­çš„åŒ…åˆ—è¡¨å’Œä¾èµ–å…³ç³»
3. æµ‹è¯•å‘å¸ƒæµç¨‹

### è‡ªå®šä¹‰ç¼–è¯‘é€»è¾‘

å¯ä»¥åœ¨åŒ…ç›®å½•ä¸‹åˆ›å»º `.compile_hook.sh` è„šæœ¬æ¥å®šåˆ¶ç¼–è¯‘è¿‡ç¨‹ï¼š

```bash
#!/bin/bash
# packages/sage-example/.compile_hook.sh

# è‡ªå®šä¹‰ç¼–è¯‘å‰å¤„ç†
pre_compile() {
    echo "æ‰§è¡Œè‡ªå®šä¹‰é¢„å¤„ç†..."
}

# è‡ªå®šä¹‰ç¼–è¯‘åå¤„ç†  
post_compile() {
    echo "æ‰§è¡Œè‡ªå®šä¹‰åå¤„ç†..."
}
```

### æ·»åŠ é€šçŸ¥æ¸ é“

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ æ–°çš„é€šçŸ¥å‡½æ•°ï¼š

```bash
# è‡ªå®šä¹‰é€šçŸ¥å‡½æ•°
send_custom_notification() {
    local message="$1"
    # å®ç°è‡ªå®šä¹‰é€šçŸ¥é€»è¾‘
}
```

## è®¸å¯è¯

æœ¬è„šæœ¬å¥—ä»¶éµå¾ª Apache-2.0 è®¸å¯è¯ã€‚

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚

---

**æ³¨æ„**: é—­æºå‘å¸ƒæ¶‰åŠçŸ¥è¯†äº§æƒä¿æŠ¤ï¼Œè¯·ç¡®ä¿éµå¾ªç›¸å…³æ³•å¾‹æ³•è§„å’Œå…¬å¸æ”¿ç­–ã€‚

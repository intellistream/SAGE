# 🤖 Agent 步骤功能说明

> **当前状态**: Playground 的 Agent 步骤可视化功能**已完全实现**，但目前显示的是**模拟数据**。  
> 真实的 Flow 执行集成正在进行中，完成后将显示实际的节点执行步骤。

---

## 什么是 Agent 步骤？

Agent 步骤是 Playground 的核心功能，用于**可视化展示执行流程**：

- 💭 **推理步骤** - 决策过程
- 🔧 **节点执行** - 节点调用和参数
- 📥 **输入数据** - 传递的参数
- 📤 **输出结果** - 返回值
- ⏱️ **执行时间** - 性能统计

---

## 当前可用节点

SAGE Studio 目前提供以下内置节点：

| 节点 | 类型 | 功能 |
|------|------|------|
| 📁 **File Reader** | 数据源 | 读取本地文件内容 |
| 🌐 **HTTP Request** | 数据源 | 发起 HTTP API 请求 |
| 📋 **JSON Parser** | 处理 | 解析 JSON 字符串 |
| ✂️ **Text Splitter** | 处理 | 分割文本为片段 |
| 📝 **File Writer** | 输出 | 写入内容到文件 |
| 📝 **Logger** | 输出 | 输出日志到控制台 |

---

## 如何测试 Agent 步骤

### 步骤 1: 启动服务

```bash
cd packages/sage-studio
./start-studio.sh
```

### 步骤 2: 创建 Flow

在画布中创建一个简单的 Flow：

**示例 1: 文件处理**
```
[File Reader] → [JSON Parser] → [Logger]
```

**示例 2: API 调用**
```
[HTTP Request] → [Text Splitter] → [File Writer]
```

### 步骤 3: 打开 Playground

点击工具栏的 **"💬 Playground"** 按钮

### 步骤 4: 发送消息

输入任意测试消息：

```
读取配置文件并解析
```

```
从 API 获取数据
```

### 步骤 5: 查看 Agent 步骤

AI 响应后，消息下方会显示 Agent 步骤面板：

```
┌─────────────────────────────────────┐
│ 🤖 Agent 执行了 3 个步骤 (模拟)     │
│                                     │
│ ▶ 💭 推理: 分析用户需求             │
│ ▶ 🔧 节点: file_reader             │
│ ▶ 💭 推理: 处理完成                 │
└─────────────────────────────────────┘
```

**点击任意步骤**即可展开查看详情！

---

## Agent 步骤类型

### 1. 推理步骤 (💭 Reasoning)

显示决策过程：

```
┌─────────────────────────────────────┐
│ 💭 推理                             │
│ ─────────────────────────────────── │
│                                     │
│ 用户需要读取文件并解析 JSON。       │
│ 将调用 file_reader 节点。          │
│                                     │
│ ⏱ 耗时: 0.5s                       │
└─────────────────────────────────────┘
```

### 2. 节点执行步骤 (🔧 Node Execution)

显示节点调用详情：

```
┌─────────────────────────────────────┐
│ 🔧 节点: file_reader                │
│ ─────────────────────────────────── │
│                                     │
│ 📥 输入:                            │
│ {                                   │
│   "file_path": "/data/config.json", │
│   "encoding": "utf-8"               │
│ }                                   │
│                                     │
│ 📤 输出:                            │
│ {                                   │
│   "content": "{...}",               │
│   "size": 1024                      │
│ }                                   │
│                                     │
│ ⏱ 耗时: 0.3s                       │
└─────────────────────────────────────┘
```

---

## UI 功能

### 交互功能

- ✅ **展开/折叠** - 点击标题切换显示
- ✅ **复制内容** - 复制步骤详情
- ✅ **执行时间** - 查看性能统计
- ✅ **颜色区分** - 不同类型不同颜色

### 会话管理

- ✅ **创建会话** - 新建对话
- ✅ **切换会话** - 在多个会话间切换
- ✅ **清空历史** - 清除消息记录

### 代码生成

- ✅ **Python 代码** - API 调用示例
- ✅ **cURL 命令** - 命令行测试
- ✅ **一键复制** - 复制到剪贴板

---

## 模拟数据示例

### 示例 1: 文件读取场景

**模拟 Agent 步骤**:

```
1️⃣ 💭 推理
   分析: 用户需要读取文件
   计划: 调用 file_reader 节点

2️⃣ 🔧 节点: file_reader
   输入: { "file_path": "/data/test.json" }
   输出: { "content": "{...}", "size": 512 }

3️⃣ 💭 推理
   结果: 文件读取成功
```

### 示例 2: HTTP 请求场景

**模拟 Agent 步骤**:

```
1️⃣ 💭 推理
   分析: 需要调用 API 获取数据
   计划: 使用 http_request 节点

2️⃣ 🔧 节点: http_request
   输入: { 
     "url": "https://api.example.com/data",
     "method": "GET"
   }
   输出: { 
     "response": "{...}",
     "status_code": 200
   }

3️⃣ 💭 推理
   结果: API 调用成功
```

---

## 使用技巧

### 1. 理解 UI 效果

当前版本的 Agent 步骤：
- ✅ **UI 完全可用** - 展示所有交互功能
- 🎭 **显示模拟数据** - 演示效果
- ⏳ **等待集成** - 真实 Flow 执行

### 2. 测试界面功能

您可以测试：
- 点击展开/折叠面板
- 查看不同类型的步骤
- 使用会话管理功能
- 生成并复制代码

### 3. 准备真实使用

- 熟悉界面布局
- 了解步骤结构
- 设计您的 Flow
- 理解数据流向

---

## 常见问题

### Q1: 为什么是模拟数据？

**原因**: Playground UI 已完成，但 Flow 执行引擎集成还在进行中。

**时间线**:
- ✅ **Phase 1**: UI 实现（已完成）
- ⏳ **Phase 2**: Flow 执行集成（进行中）
- 📅 **Phase 3**: 实时流式输出（计划中）

### Q2: 什么时候能看到真实数据？

**答**: Flow 执行引擎集成完成后，Agent 步骤将显示：
- 真实的节点执行顺序
- 实际的输入输出数据
- 准确的执行时间统计
- 真实的错误信息

### Q3: 当前可以做什么？

**答**: 您可以：
- ✅ 测试 Playground 所有 UI 功能
- ✅ 熟悉 Agent 步骤界面
- ✅ 设计和保存 Flow
- ✅ 学习使用文档
- ✅ 为真实使用做准备

---

## 开发路线图

### ✅ 已完成

- Playground UI 组件
- Agent 步骤可视化
- 会话管理
- 代码生成
- 样式和交互

### ⏳ 进行中

- Flow 执行引擎集成
- 真实节点数据绑定
- 错误处理完善

### 📅 计划中

- 实时流式输出 (SSE/WebSocket)
- 会话持久化 (数据库)
- 步骤导出功能
- 性能分析工具
- A/B 测试支持

---

## 快速命令

```bash
# 启动服务
cd packages/sage-studio
./start-studio.sh

# 测试功能
./test_playground.sh

# 查看日志
tail -f /tmp/sage-studio-backend.log
tail -f /tmp/sage-studio-frontend.log

# 访问应用
# http://localhost:5173
```

---

## 相关文档

| 文档 | 说明 |
|------|------|
| `README_PLAYGROUND.md` | 完整使用指南 |
| `start-studio.sh` | 启动脚本 |
| `test_playground.sh` | 测试脚本 |
| `frontend/PLAYGROUND_IMPLEMENTATION.md` | 实现文档 |

---

**祝您使用愉快！** 🎉

体验 Playground 界面，期待真实 Flow 执行的到来！

# SAGE Studio v2.0 - å¿«é€Ÿå‚è€ƒ

## ğŸ¯ å·²å®ç°åŠŸèƒ½é€ŸæŸ¥

### æ ¸å¿ƒåŠŸèƒ½
| åŠŸèƒ½ | çŠ¶æ€ | ä½ç½® | å¿«æ·é”® |
|------|------|------|--------|
| ä¿å­˜æµç¨‹ | âœ… | Toolbar â†’ ä¿å­˜æŒ‰é’® | - |
| åŠ è½½æµç¨‹ | âœ… | Toolbar â†’ æ‰“å¼€æŒ‰é’® | - |
| è¿è¡Œæµç¨‹ | âœ… | Toolbar â†’ è¿è¡ŒæŒ‰é’® | - |
| åœæ­¢æµç¨‹ | âœ… | Toolbar â†’ åœæ­¢æŒ‰é’® | - |
| æ”¾å¤§è§†å›¾ | âœ… | Toolbar â†’ æ”¾å¤§æŒ‰é’® | - |
| ç¼©å°è§†å›¾ | âœ… | Toolbar â†’ ç¼©å°æŒ‰é’® | - |
| æ‹–æ”¾èŠ‚ç‚¹ | âœ… | NodePalette â†’ æ‹–åˆ°ç”»å¸ƒ | - |
| è¿æ¥èŠ‚ç‚¹ | âœ… | æ‹–åŠ¨èŠ‚ç‚¹ç«¯ç‚¹ | - |
| ç¼–è¾‘å±æ€§ | âœ… | PropertiesPanel | - |
| åŠ¨æ€é…ç½® | âœ… | PropertiesPanel â†’ é…ç½®å‚æ•° | - |

### ç»„ä»¶æ¶æ„

```
App.tsx (ä¸»å¸ƒå±€)
â”œâ”€â”€ Toolbar.tsx (å·¥å…·æ )
â”‚   â”œâ”€â”€ è¿è¡Œ/åœæ­¢æ§åˆ¶
â”‚   â”œâ”€â”€ ä¿å­˜/æ‰“å¼€æ¨¡æ€æ¡†
â”‚   â””â”€â”€ ç¼©æ”¾æ§åˆ¶
â”œâ”€â”€ NodePalette.tsx (èŠ‚ç‚¹é¢æ¿)
â”‚   â”œâ”€â”€ æœç´¢èŠ‚ç‚¹
â”‚   â”œâ”€â”€ åˆ†ç±»æ˜¾ç¤º
â”‚   â””â”€â”€ æ‹–æ”¾æ”¯æŒ
â”œâ”€â”€ FlowEditor.tsx (ç”»å¸ƒ)
â”‚   â”œâ”€â”€ React Flow é›†æˆ
â”‚   â”œâ”€â”€ æ‹–æ”¾å¤„ç†
â”‚   â”œâ”€â”€ èŠ‚ç‚¹/è¾¹ç®¡ç†
â”‚   â””â”€â”€ MiniMap/Controls
â”œâ”€â”€ PropertiesPanel.tsx (å±æ€§é¢æ¿)
â”‚   â”œâ”€â”€ åŸºç¡€å±æ€§ç¼–è¾‘
â”‚   â””â”€â”€ åŠ¨æ€é…ç½®è¡¨å•
â””â”€â”€ StatusBar.tsx (çŠ¶æ€æ )
```

### çŠ¶æ€ç®¡ç† (Zustand)

**flowStore.ts**
```typescript
{
  nodes: Node[]                    // æ‰€æœ‰èŠ‚ç‚¹
  edges: Edge[]                    // æ‰€æœ‰è¿æ¥
  selectedNode: Node | null        // å½“å‰é€‰ä¸­èŠ‚ç‚¹
  reactFlowInstance: any | null    // React Flow å®ä¾‹
  
  // æ–¹æ³•
  onNodesChange()                  // èŠ‚ç‚¹å˜åŒ–å¤„ç†
  onEdgesChange()                  // è¾¹å˜åŒ–å¤„ç†
  addNode()                        // æ·»åŠ èŠ‚ç‚¹
  updateNode()                     // æ›´æ–°èŠ‚ç‚¹æ•°æ®
  deleteNode()                     // åˆ é™¤èŠ‚ç‚¹
  selectNode()                     // é€‰æ‹©èŠ‚ç‚¹
  setNodes()                       // æ‰¹é‡è®¾ç½®èŠ‚ç‚¹
  setEdges()                       // æ‰¹é‡è®¾ç½®è¾¹
  setReactFlowInstance()           // è®¾ç½®å®ä¾‹
}
```

### API æ¥å£

**services/api.ts**
```typescript
// èŠ‚ç‚¹ç®¡ç†
getNodes(): Promise<NodeDefinition[]>

// æµç¨‹ç®¡ç†
submitFlow(config: FlowConfig): Promise<{ pipeline_id: string }>
getAllJobs(): Promise<Job[]>

// æ‰§è¡Œæ§åˆ¶
startJob(jobId: string): Promise<{ status: string, message: string }>
stopJob(jobId: string, duration?: string): Promise<{ status: string, message: string }>

// æ—¥å¿—æŸ¥è¯¢
getJobLogs(jobId: string, offset?: number): Promise<JobLogs>

// å¥åº·æ£€æŸ¥
healthCheck(): Promise<any>
```

## ğŸ“ ä½¿ç”¨æŒ‡å—

### 1. åˆ›å»ºæ–°æµç¨‹

1. ä»å·¦ä¾§ NodePalette æ‹–åŠ¨èŠ‚ç‚¹åˆ°ç”»å¸ƒ
2. æ‹–åŠ¨èŠ‚ç‚¹ç«¯ç‚¹åˆ›å»ºè¿æ¥
3. ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹/ç¼–è¾‘å±æ€§
4. åœ¨å³ä¾§ PropertiesPanel é…ç½®å‚æ•°

### 2. ä¿å­˜æµç¨‹

1. ç‚¹å‡»å·¥å…·æ  "ä¿å­˜" æŒ‰é’®
2. è¾“å…¥æµç¨‹åç§°ï¼ˆå¿…å¡«ï¼‰
3. è¾“å…¥æµç¨‹æè¿°ï¼ˆå¯é€‰ï¼‰
4. ç‚¹å‡»ç¡®è®¤
5. æŸ¥çœ‹æˆåŠŸæ¶ˆæ¯ä¸­çš„ Pipeline ID

### 3. åŠ è½½æµç¨‹

1. ç‚¹å‡»å·¥å…·æ  "æ‰“å¼€" æŒ‰é’®
2. åœ¨åˆ—è¡¨ä¸­é€‰æ‹©è¦åŠ è½½çš„æµç¨‹
3. ç‚¹å‡»æµç¨‹å³ä¾§çš„ "æ‰“å¼€" æŒ‰é’®
4. ç­‰å¾…ç”»å¸ƒæ¸²æŸ“å®Œæˆ

### 4. è¿è¡Œæµç¨‹

1. ç¡®ä¿æµç¨‹å·²ä¿å­˜æˆ–ç”»å¸ƒæœ‰èŠ‚ç‚¹
2. ç‚¹å‡»å·¥å…·æ  "è¿è¡Œ" æŒ‰é’®
3. è§‚å¯ŸèŠ‚ç‚¹çŠ¶æ€å˜ä¸ºç»¿è‰²ï¼ˆè¿è¡Œä¸­ï¼‰
4. ç­‰å¾…æ‰§è¡Œå®Œæˆ

### 5. åœæ­¢æµç¨‹

1. åœ¨æµç¨‹è¿è¡Œæ—¶ç‚¹å‡» "åœæ­¢" æŒ‰é’®
2. ç¡®è®¤èŠ‚ç‚¹çŠ¶æ€é‡ç½®ä¸ºç°è‰²ï¼ˆç©ºé—²ï¼‰

### 6. ç¼–è¾‘èŠ‚ç‚¹å±æ€§

1. å•å‡»é€‰ä¸­èŠ‚ç‚¹
2. åœ¨å³ä¾§å±æ€§é¢æ¿ç¼–è¾‘ï¼š
   - èŠ‚ç‚¹åç§°
   - æè¿°ä¿¡æ¯
   - é…ç½®å‚æ•°
   - å¯ç”¨/ç¦ç”¨å¼€å…³
3. æ›´æ”¹å®æ—¶ä¿å­˜åˆ°èŠ‚ç‚¹æ•°æ®

### 7. ç”»å¸ƒæ“ä½œ

- **å¹³ç§»**: é¼ æ ‡å·¦é”®æ‹–åŠ¨ç©ºç™½åŒºåŸŸ
- **ç¼©æ”¾**: 
  - é¼ æ ‡æ»šè½®
  - å·¥å…·æ æ”¾å¤§/ç¼©å°æŒ‰é’®
  - Controls é¢æ¿
- **å¤šé€‰**: Shift + é¼ æ ‡æ¡†é€‰ï¼ˆå¾…å®ç°ï¼‰
- **åˆ é™¤**: é€‰ä¸­èŠ‚ç‚¹åæŒ‰ Delete é”®

## ğŸ”§ å¼€å‘è€…å‚è€ƒ

### æ·»åŠ æ–°èŠ‚ç‚¹ç±»å‹

1. åç«¯æ³¨å†ŒèŠ‚ç‚¹å®šä¹‰
2. å‰ç«¯è‡ªåŠ¨ä» API åŠ è½½
3. ï¼ˆå¯é€‰ï¼‰åœ¨ PropertiesPanel æ·»åŠ é…ç½®å®šä¹‰

### æ·»åŠ æ–°é…ç½®é¡¹

åœ¨ `PropertiesPanel.tsx` ä¸­æ›´æ–° `getNodeConfig()`:

```typescript
const getNodeConfig = () => {
  return {
    your_node_type: [
      { 
        name: 'param_name',
        label: 'å‚æ•°åç§°',
        type: 'text|textarea|number|select',
        defaultValue: 'é»˜è®¤å€¼',
        options: ['é€‰é¡¹1', 'é€‰é¡¹2']  // ä»… select ç±»å‹
      }
    ]
  }
}
```

æ”¯æŒçš„é…ç½®ç±»å‹ï¼š
- `text`: å•è¡Œæ–‡æœ¬è¾“å…¥
- `textarea`: å¤šè¡Œæ–‡æœ¬è¾“å…¥
- `number`: æ•°å­—è¾“å…¥ï¼ˆå¸¦åŠ å‡æŒ‰é’®ï¼‰
- `select`: ä¸‹æ‹‰é€‰æ‹©ï¼ˆéœ€è¦ optionsï¼‰

### æ‰©å±•èŠ‚ç‚¹çŠ¶æ€

åœ¨ `CustomNode.tsx` ä¸­æ·»åŠ æ–°çŠ¶æ€æ ·å¼ï¼š

```typescript
const statusColors = {
  idle: 'text-gray-400',
  running: 'text-green-500',
  success: 'text-green-600',
  error: 'text-red-500',
  // æ·»åŠ æ–°çŠ¶æ€
  warning: 'text-yellow-500',
}
```

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹èŠ‚ç‚¹æ•°æ®**:
   ```javascript
   const nodes = useFlowStore.getState().nodes
   console.log(nodes)
   ```

2. **æŸ¥çœ‹é€‰ä¸­èŠ‚ç‚¹**:
   ```javascript
   const selected = useFlowStore.getState().selectedNode
   console.log(selected)
   ```

3. **æ‰‹åŠ¨æ“ä½œç”»å¸ƒ**:
   ```javascript
   const instance = useFlowStore.getState().reactFlowInstance
   instance?.fitView()
   instance?.zoomIn()
   instance?.zoomOut()
   ```

## ğŸ› æ•…éšœæ’é™¤

### ä¿å­˜å¤±è´¥

**é—®é¢˜**: ç‚¹å‡»ä¿å­˜åæç¤ºé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ (localhost:8080)
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ç½‘ç»œè¯·æ±‚
3. ç¡®è®¤ç”»å¸ƒä¸Šè‡³å°‘æœ‰ä¸€ä¸ªèŠ‚ç‚¹
4. æŸ¥çœ‹é”™è¯¯æ¶ˆæ¯è¯¦æƒ…

### èŠ‚ç‚¹ä¸æ˜¾ç¤º

**é—®é¢˜**: æ‹–æ”¾åèŠ‚ç‚¹æ²¡æœ‰å‡ºç°åœ¨ç”»å¸ƒä¸Š

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ FlowEditor æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–
2. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯
3. ç¡®è®¤ addNode æ–¹æ³•è¢«è°ƒç”¨
4. æ£€æŸ¥èŠ‚ç‚¹ä½ç½®æ˜¯å¦åœ¨å¯è§åŒºåŸŸ

### å±æ€§é¢æ¿ä¸æ›´æ–°

**é—®é¢˜**: ä¿®æ”¹å±æ€§åèŠ‚ç‚¹æ•°æ®æ²¡æœ‰å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ updateNode æ–¹æ³•æ­£ç¡®è°ƒç”¨
2. æ£€æŸ¥ selectedNode æ˜¯å¦åŒæ­¥æ›´æ–°
3. æŸ¥çœ‹ flowStore ä¸­çš„æ•°æ®æ˜¯å¦æ­£ç¡®
4. é‡æ–°é€‰æ‹©èŠ‚ç‚¹åˆ·æ–°å±æ€§é¢æ¿

### æµç¨‹æ— æ³•è¿è¡Œ

**é—®é¢˜**: ç‚¹å‡»è¿è¡ŒæŒ‰é’®æ²¡æœ‰ååº”

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ç”»å¸ƒä¸Šæœ‰èŠ‚ç‚¹
2. æ£€æŸ¥åç«¯ API æ˜¯å¦å¯è¾¾
3. æŸ¥çœ‹ submitFlow å’Œ startJob è¿”å›ç»“æœ
4. æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æœ‰å¿…éœ€çš„é…ç½®å‚æ•°

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [PHASE2_GUIDE.md](./docs/PHASE2_GUIDE.md) - Phase 2 å®Œæ•´æŒ‡å—
- [CHANGELOG.md](./CHANGELOG.md) - è¯¦ç»†æ›´æ–°æ—¥å¿—
- [README.md](./README.md) - é¡¹ç›®æ¦‚è§ˆ

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

1. â³ å®ç°çŠ¶æ€è½®è¯¢ï¼ˆè‡ªåŠ¨æ›´æ–°èŠ‚ç‚¹çŠ¶æ€ï¼‰
2. â³ ä»åç«¯è·å–åŠ¨æ€èŠ‚ç‚¹é…ç½®
3. â³ æ·»åŠ æ’¤é”€/é‡åšåŠŸèƒ½
4. â³ å®ç°é”®ç›˜å¿«æ·é”®
5. â³ æ·»åŠ æµç¨‹éªŒè¯é€»è¾‘

---

**æœ€åæ›´æ–°**: 2025-01-14  
**ç‰ˆæœ¬**: v2.0 (Phase 2 å®Œæˆ)

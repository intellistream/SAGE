# SAGE å‘½ä»¤è¡Œç•Œé¢ (CLI)

SAGEç»Ÿä¸€å‘½ä»¤è¡Œå·¥å…·ï¼Œæä¾›å®Œæ•´çš„ä½œä¸šç®¡ç†ã€ç³»ç»Ÿéƒ¨ç½²å’Œé›†ç¾¤ç®¡ç†åŠŸèƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
python sage/cli/setup.py
```

### åŸºæœ¬å‘½ä»¤

```bash
# å¯åŠ¨ä½œä¸šç®¡ç†å™¨
sage jobmanager start

# æŸ¥çœ‹ä½œä¸š
sage job list
sage job show <job_id>

# å¯åŠ¨Studioç•Œé¢
sage studio start
```

## ğŸ“‹ ä¸»è¦å‘½ä»¤

### ä½œä¸šç®¡ç† (`sage job`)

- `list` - åˆ—å‡ºæ‰€æœ‰ä½œä¸š
- `show <job_id>` - æ˜¾ç¤ºä½œä¸šè¯¦æƒ…
- `stop <job_id>` - åœæ­¢ä½œä¸š
- `continue <job_id>` - ç»§ç»­ä½œä¸š
- `delete <job_id>` - åˆ é™¤ä½œä¸š
- `monitor` - å®æ—¶ç›‘æ§æ‰€æœ‰ä½œä¸š
- `status <job_id>` - è·å–ä½œä¸šçŠ¶æ€

### ä½œä¸šç®¡ç†å™¨æœåŠ¡ (`sage jobmanager`)

- `start` - å¯åŠ¨JobManageræœåŠ¡
- `stop` - åœæ­¢JobManageræœåŠ¡
- `status` - æ˜¾ç¤ºJobManagerçŠ¶æ€
- `restart` - é‡å¯JobManageræœåŠ¡

### Studioç•Œé¢ (`sage studio`)

- `start` - å¯åŠ¨Studioå¯è§†åŒ–ç¼–è¾‘å™¨
- `stop` - åœæ­¢StudioæœåŠ¡
- `status` - æŸ¥çœ‹StudioçŠ¶æ€
- `health` - å¥åº·æ£€æŸ¥

### é›†ç¾¤ç®¡ç† (`sage cluster`)

- `create` - åˆ›å»ºé›†ç¾¤
- `scale` - é›†ç¾¤æ‰©ç¼©å®¹
- `info` - é›†ç¾¤ä¿¡æ¯

## ğŸ”„ è¿ç§»æŒ‡å—

ä»æ—§CLIè¿ç§»åˆ°æ–°ç»Ÿä¸€CLIï¼š

| æ—§å‘½ä»¤              | æ–°å‘½ä»¤                  |
| ------------------- | ----------------------- |
| `sage-jm list`      | `sage job list`         |
| `sage-jm show 1`    | `sage job show 1`       |
| `sage-deploy start` | `sage jobmanager start` |

## ğŸ“– è¯¦ç»†æ–‡æ¡£

æ›´å¤šè¯¦ç»†çš„å‘½ä»¤å‚è€ƒã€é…ç½®é€‰é¡¹å’Œæ‰©å±•å¼€å‘ï¼Œè¯·å‚é˜…ï¼š

**[ğŸ“š CLI å®Œæ•´å‚è€ƒæ–‡æ¡£](../../../docs-public/docs_src/tools/cli_reference.md)**

åŒ…å«å®Œæ•´çš„ï¼š

- æ‰€æœ‰å‘½ä»¤çš„è¯¦ç»†è¯´æ˜å’Œå‚æ•°
- é…ç½®æ–‡ä»¶æ ¼å¼å’Œé€‰é¡¹
- æ¶æ„è®¾è®¡å’Œç»„ä»¶è¯´æ˜
- æ•…éšœæ’é™¤å’Œæ€§èƒ½ä¼˜åŒ–
- æ‰©å±•å¼€å‘å’Œæ’ä»¶ç³»ç»Ÿ

# å¯åŠ¨ä½œä¸šç®¡ç†å™¨

sage jobmanager start

# æ£€æŸ¥å¥åº·çŠ¶æ€

sage job health

````

### é…ç½®é—®é¢˜
```bash
# æŸ¥çœ‹å½“å‰é…ç½®
sage config

# æ‰‹åŠ¨ç¼–è¾‘é…ç½®
vi ~/.sage/config.yaml
````

## ğŸ“š ç¤ºä¾‹

### å®Œæ•´å·¥ä½œæµç¨‹

```bash
# 1. å¯åŠ¨ä½œä¸šç®¡ç†å™¨
sage jobmanager start

# 2. æ£€æŸ¥å¥åº·çŠ¶æ€
sage job health

# 3. è¿è¡Œè„šæœ¬
sage job run my_analysis.py --input data.csv

# 4. ç›‘æ§ä½œä¸š
sage job monitor

# 5. æŸ¥çœ‹ç‰¹å®šä½œä¸š
sage job show 1

# 6. åœæ­¢ä½œä¸šï¼ˆå¦‚éœ€è¦ï¼‰
sage job stop 1

# 7. åœæ­¢ä½œä¸šç®¡ç†å™¨
sage jobmanager stop
```

### æ‰¹é‡æ“ä½œ

```bash
# æ¸…ç†æ‰€æœ‰ä½œä¸š
sage job cleanup --force

# é‡å¯ä½œä¸šç®¡ç†å™¨
sage jobmanager restart

# æ‰¹é‡ç›‘æ§
sage job monitor --refresh 2
```

## ğŸ“ æ ¸å¿ƒç»„ä»¶

### [æµ‹è¯•æ¨¡å—](./tests/)

å®Œæ•´çš„CLIåŠŸèƒ½æµ‹è¯•è¦†ç›–ï¼Œç¡®ä¿å‘½ä»¤è¡Œå·¥å…·çš„å¯é æ€§ã€‚

### æ ¸å¿ƒç®¡ç†å™¨

#### `main.py`

CLIä¸»å…¥å£ç¨‹åºï¼š

- å‘½ä»¤è§£æå’Œè·¯ç”±
- å…¨å±€é€‰é¡¹å¤„ç†
- é”™è¯¯å¤„ç†å’Œç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
- æ’ä»¶ç³»ç»Ÿå’Œæ‰©å±•æ”¯æŒ

#### `job.py`

ä½œä¸šç®¡ç†å‘½ä»¤ï¼š

- ä½œä¸šæäº¤å’Œç®¡ç†
- ä½œä¸šçŠ¶æ€æŸ¥è¯¢å’Œç›‘æ§
- ä½œä¸šç”Ÿå‘½å‘¨æœŸæ§åˆ¶
- æ‰¹é‡ä½œä¸šæ“ä½œ

#### `jobmanager.py`

ä½œä¸šç®¡ç†å™¨æœåŠ¡å‘½ä»¤ï¼š

- JobManageræœåŠ¡å¯åŠ¨å’Œåœæ­¢
- æœåŠ¡å¥åº·æ£€æŸ¥
- ç³»ç»ŸçŠ¶æ€ç›‘æ§
- é…ç½®ç®¡ç†

#### `cluster_manager.py`

é›†ç¾¤ç®¡ç†å™¨ï¼š

- é›†ç¾¤åˆ›å»ºå’Œé”€æ¯
- èŠ‚ç‚¹ç®¡ç†å’Œç›‘æ§
- èµ„æºåˆ†é…å’Œè°ƒåº¦
- é›†ç¾¤æ‰©ç¼©å®¹æ“ä½œ

#### `head_manager.py`

å¤´èŠ‚ç‚¹ç®¡ç†å™¨ï¼š

- å¤´èŠ‚ç‚¹æœåŠ¡å¯åŠ¨
- ä½œä¸šè°ƒåº¦å’Œåˆ†å‘
- é›†ç¾¤åè°ƒå’Œé€šä¿¡
- èµ„æºç›‘æ§å’ŒæŠ¥å‘Š

#### `worker_manager.py`

å·¥ä½œèŠ‚ç‚¹ç®¡ç†å™¨ï¼š

- å·¥ä½œèŠ‚ç‚¹æ³¨å†Œå’Œç®¡ç†
- ä»»åŠ¡æ‰§è¡Œå’Œç›‘æ§
- èµ„æºä½¿ç”¨æŠ¥å‘Š
- èŠ‚ç‚¹å¥åº·çŠ¶æ€ç»´æŠ¤

#### `jobmanager_controller.py`

ä½œä¸šç®¡ç†å™¨æ§åˆ¶å™¨ï¼š

- JobManageræœåŠ¡æ§åˆ¶
- ä½œä¸šé˜Ÿåˆ—ç®¡ç†
- ä½œä¸šä¼˜å…ˆçº§å’Œä¾èµ–å¤„ç†
- çŠ¶æ€åŒæ­¥å’Œé€šçŸ¥

#### `studio_manager.py`

Studioç•Œé¢ç®¡ç†å™¨ï¼š

- StudioæœåŠ¡å¯åŠ¨å’Œé…ç½®
- å¯è§†åŒ–ç•Œé¢ç®¡ç†
- ç‰ˆæœ¬ç®¡ç†å’Œæ›´æ–°
- ç•Œé¢å®šåˆ¶å’Œæ’ä»¶ç®¡ç†

#### `config_manager.py`

é…ç½®ç®¡ç†å™¨ï¼š

- é…ç½®æ–‡ä»¶åŠ è½½å’Œè§£æ
- é…ç½®éªŒè¯å’Œåˆå¹¶
- åŠ¨æ€é…ç½®æ›´æ–°
- é…ç½®æ¨¡æ¿å’Œé¢„è®¾

#### `setup.py`

å®‰è£…è®¾ç½®è„šæœ¬ï¼š

- ç¯å¢ƒä¾èµ–æ£€æŸ¥å’Œå®‰è£…
- CLIå·¥å…·æ³¨å†Œå’Œé…ç½®
- ç³»ç»Ÿåˆå§‹åŒ–å’Œé…ç½®
- æƒé™è®¾ç½®å’Œè·¯å¾„é…ç½®

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### å‘½ä»¤ç»“æ„

```
sage
â”œâ”€â”€ job          # ä½œä¸šç®¡ç†
â”‚   â”œâ”€â”€ list
â”‚   â”œâ”€â”€ show
â”‚   â”œâ”€â”€ run
â”‚   â”œâ”€â”€ stop
â”‚   â”œâ”€â”€ monitor
â”‚   â””â”€â”€ ...
â”œâ”€â”€ jobmanager   # ä½œä¸šç®¡ç†å™¨æœåŠ¡
â”‚   â”œâ”€â”€ start
â”‚   â”œâ”€â”€ stop
â”‚   â”œâ”€â”€ status
â”‚   â””â”€â”€ ...
â”œâ”€â”€ studio       # Studioç•Œé¢
â”‚   â”œâ”€â”€ start
â”‚   â”œâ”€â”€ stop
â”‚   â”œâ”€â”€ status
â”‚   â””â”€â”€ ...
â”œâ”€â”€ cluster      # é›†ç¾¤ç®¡ç†
â”‚   â”œâ”€â”€ create
â”‚   â”œâ”€â”€ scale
â”‚   â”œâ”€â”€ info
â”‚   â””â”€â”€ ...
â””â”€â”€ config       # é…ç½®ç®¡ç†
    â”œâ”€â”€ show
    â”œâ”€â”€ set
    â””â”€â”€ ...
```

### ç»„ä»¶äº¤äº’

```
CLI Main
    â†“
Command Router
    â†“
Specific Manager (Job/JobManager/Studio/Cluster)
    â†“
SAGE Core Services
```

## ğŸ”’ å®‰å…¨å’Œæƒé™

### æƒé™ç®¡ç†

- åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- ç”¨æˆ·èº«ä»½éªŒè¯
- æ“ä½œæƒé™éªŒè¯
- å®¡è®¡æ—¥å¿—è®°å½•

### å®‰å…¨ç‰¹æ€§

- é…ç½®æ–‡ä»¶åŠ å¯†
- é€šä¿¡åŠ å¯†ä¼ è¾“
- æ•æ„Ÿä¿¡æ¯ä¿æŠ¤
- å®‰å…¨çš„ä¸´æ—¶æ–‡ä»¶å¤„ç†

## âš¡ æ€§èƒ½ä¼˜åŒ–

### å“åº”é€Ÿåº¦

- å‘½ä»¤ç¼“å­˜æœºåˆ¶
- å¼‚æ­¥æ“ä½œæ”¯æŒ
- æ‰¹é‡æ“ä½œä¼˜åŒ–
- æ™ºèƒ½çŠ¶æ€æ›´æ–°

### èµ„æºæ•ˆç‡

- å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- ç½‘ç»œè¯·æ±‚åˆå¹¶
- è¿æ¥æ± ç®¡ç†
- åå°ä»»åŠ¡å¤„ç†

## ğŸ”§ æ‰©å±•å¼€å‘

### è‡ªå®šä¹‰å‘½ä»¤

```python
from sage.cli.base import BaseCommand


class CustomCommand(BaseCommand):
    def add_arguments(self, parser):
        parser.add_argument("--option", help="Custom option")

    def handle(self, args):
        # å®ç°è‡ªå®šä¹‰é€»è¾‘
        return result
```

### æ’ä»¶ç³»ç»Ÿ

- æ”¯æŒç¬¬ä¸‰æ–¹å‘½ä»¤æ’ä»¶
- åŠ¨æ€åŠ è½½å’Œæ³¨å†Œ
- æ’ä»¶ä¾èµ–ç®¡ç†
- æ’ä»¶é…ç½®å’Œå‚æ•°

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### å®æ—¶ç›‘æ§

- ä½œä¸šçŠ¶æ€å®æ—¶æ›´æ–°
- ç³»ç»Ÿèµ„æºç›‘æ§
- é”™è¯¯å’Œå¼‚å¸¸è¿½è¸ª
- æ€§èƒ½æŒ‡æ ‡æ”¶é›†

### æ—¥å¿—ç³»ç»Ÿ

- ç»“æ„åŒ–æ—¥å¿—è®°å½•
- å¤šçº§æ—¥å¿—è¾“å‡º
- æ—¥å¿—è½®è½¬å’Œå½’æ¡£
- è¿œç¨‹æ—¥å¿—èšåˆ

## ğŸŒ å¤šç¯å¢ƒæ”¯æŒ

### ç¯å¢ƒé…ç½®

- å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒ
- ç¯å¢ƒéš”ç¦»å’Œåˆ‡æ¢
- é…ç½®ç»§æ‰¿å’Œè¦†ç›–
- ç¯å¢ƒç‰¹å®šçš„é»˜è®¤å€¼

### éƒ¨ç½²æ¨¡å¼

- æœ¬åœ°å•æœºéƒ¨ç½²
- åˆ†å¸ƒå¼é›†ç¾¤éƒ¨ç½²
- å®¹å™¨åŒ–éƒ¨ç½²
- äº‘ç«¯éƒ¨ç½²

SAGE CLIè‡´åŠ›äºä¸ºç”¨æˆ·æä¾›ç®€å•ã€å¼ºå¤§ã€å¯é çš„å‘½ä»¤è¡Œä½“éªŒï¼Œè®©å¤æ‚çš„åˆ†å¸ƒå¼è®¡ç®—å˜å¾—è§¦æ‰‹å¯åŠã€‚

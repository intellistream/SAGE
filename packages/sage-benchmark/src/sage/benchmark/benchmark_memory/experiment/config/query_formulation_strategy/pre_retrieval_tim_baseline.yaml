# ============================================================
# PreRetrieval 实验: TiM + Baseline (V1)
# 记忆体结构: TiM (LSH哈希桶 + 向量检索)
# PreRetrieval 策略: none (对照基线)
# ============================================================

runtime:
  dataset: "locomo"
  memory_insert_verbose: false
  memory_test_verbose: true
  test_segments: 10
  service_timeout: 600.0

  prompt_template: |
    Based on the above context, answer the following question concisely.

    Question: {question}
    Answer:

  prompt_template_category5: |
    Based on the above context, answer the following question.

    Question: {question}
    Answer:

  # LLM 配置 (统一)
  api_key: "token-abc123"
  base_url: "http://sage2:8000/v1"
  model_name: "/home/cyb/Llama-3.1-8B-Instruct"
  max_tokens: 512
  temperature: 0.3
  seed: 42
  memory_name: "TiM_Baseline"

  # Embedding 配置 (统一)
  embedding_base_url: "http://localhost:8091/v1"
  embedding_model: "BAAI/bge-m3"

# ============================================================
# 服务配置: TiM (vector_memory + IndexLSH)
# ============================================================
services:
  register_memory_service: "vector_memory"
  vector_memory:
    dim: 1024
    index_type: "IndexLSH"
    index_config:
      nbits: 128
      rotate_data: true

# ============================================================
# Operator 配置: 固定其他阶段为 TiM baseline
# ============================================================
operators:
  # PreInsert: 固定为 TiM 的三元组提取
  pre_insert:
    action: "extract.triple"
    extraction_method: "llm"
    max_triplets: 10
    keep_original: false

  # PostInsert: 固定为 TiM 的蒸馏
  post_insert:
    action: "distillation"
    retrieve_count: 10
    min_merge_count: 5

  # PreRetrieval: 实验变量 - Baseline
  pre_retrieval:
    action: "none"  # 直接使用原始问题，不做任何优化

  # PostRetrieval: 固定为 TiM 的 rerank
  post_retrieval:
    action: "rerank"
    rerank_type: "semantic"
    top_k: 5
